<!DOCTYPE html>
<html lang="sv-se">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Callista Enterprise - seniora IT-arkitekter och systemutvecklare inom Java, öppen källkod, agil utveckling och systemintegration">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no"/>

    <link rel="icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="shortcut icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../../../../../../images/icons/callista_favicon_160x160.png">

    <title>Spring Boot App as a Windows Service | Callista</title>

    <link rel="stylesheet" href="../../../../../../css/style.css%3Fv=1.css">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for callistaenterprise.se" href="../../../../../../feed.xml" />

    <!--[if lte IE 8]>
    <style>* { display: none !important; }</style>
    <meta http-equiv="refresh" content="0; url=/oldie/"/>
    <![endif]-->

    <script type="text/javascript" src="https://use.typekit.net/kig5egm.js"></script>
    <script type="text/javascript">
        try {
            Typekit.load({ async: true });
        } catch (e) {
        }
    </script>

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
     fbq('init', '804675599711872');
     fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1" src="https://www.facebook.com/tr?id=804675599711872&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->

</head>
<body>

    <header class="ce-header" data-scroll="0">
    <nav>
        <img alt="menubg" class="ce-menu-icon" style="z-index:3; top: 0px; width: 50px; height: 100%;" src="../../../../../../images/icons/menu_background.png">
        <a class="ce-logotype" href="../../../../../../index.html" style="z-index: 2;">
            <img alt="Callista" style="max-width: 100%; height: auto;" src="../../../../../../images/logotype/callista_small2.svg">
        </a>
        <table>
            <tr>
                <td>
            <ul id="menu-primary" class="ce-menu-primary">
                
                    
                            <li><a href="../../../../../../om/index.html">Om oss</a></li>
                    
                
                    
                            <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                    
                
                    
                            <li><a href="../../../../../../event.html">Event</a></li>
                    
                
                    
                        
                            <li><a class="ce-active" href="../../../../../../blogg.html">Blogg</a></li>
                        
                    
                
                    
                            <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                    
                
            </ul>
                </td>

                <td>
            <ul class="ce-menu-secondary">
                
                <li><a href="../../../../../../english/index.html">English</a></li>
                
            </ul>
                </td>
            </tr>
        </table>
            <a id="menu" class="ce-menu-icon" href="index.html#" style="z-index: 4;">
                <img alt="Visa meny" src="../../../../../../images/icons/menu.png">
            </a>
            <a class="ce-search-icon" href="index.html#">
                <img alt="Sök" src="../../../../../../images/icons/search.png">
            </a>

        </table>
    </nav>
</header>


    <div class="ce-main">
        <section class="ce-start lazyImg">
    <article>
        <h1>Blogg</h1>
        <p class="ce-ingress">
            Här finns tekniska artiklar, presentationer och nyheter om arkitektur och systemutveckling. Håll dig uppdaterad, följ oss på <a class="ce-active" href="http://twitter.com/callistaent">Twitter</a>
        </p>
    </article>
</section>

<section class="ce-section">
    <div class="ce-content">
        
        

        
        

        <article class="ce-blog">
            <header>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <img alt="Callista medarbetare Peter Larsson" src="../../../../../../assets/medarbetare/peterlarsson_mini.png">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <h2>
        <a href="index.html">Spring Boot App as a Windows Service</a>
        
        
    </h2>
    <h3>
        <time datetime="2015-10-09T00:00:00+00:00">
            09 October 2015
        </time>
        //
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        
        
        <a href="../../../../../../om/medarbetare/peterlarsson/index.html">Peter Larsson</a>
        

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </h3>
    
</header>




<p>Spring Boot is great and in combination with Docker it’s really fun to develop production grade applications. Though, in one of my recent projects the target execution platform turned out to be Windows (2008 R2) on “physical” servers (<em>sigh</em>…).</p>

<p>Attempting to be a good citizen the Spring Boot App in question preferably should be managed as yet another Windows Service. Hmm… appear to be an old problem with several well-known solutions, but after some googleing I decided to share our solution.</p>

<h3 id="open-source-alternatives">Open Source Alternatives</h3>

<p>Our requirements was only a few:</p>

<ol>
  <li>Open source always is preferred</li>
  <li>Support for Java 8 (64 and 32 bit)</li>
  <li>Simple to install, uninstall and upgrade the Java App</li>
  <li>Nice to have an option to customize the App icon (co-location with other Apps on the same server)</li>
</ol>

<p>I’ve had some experience (long time ago) with <a href="http://commons.apache.org/proper/commons-daemon/">Apache Commons Daemon</a> which probably would do the job. Anyway, googled for alternatives and found <a href="http://winrun4j.sourceforge.net">WinRun4J</a>, which seemed surprisingly simple. The decision was to give the later a try (after all it’s always more fun to do something new).</p>

<p>I will not dig deep into all of the capabilities of WinRun4J, since all you need to know is neatly summarized at their <a href="http://winrun4j.sourceforge.net">site</a>. There are differences regarding licensing, and WinRun4J is licensed under the “copyleft” <a href="http://www.eclipse.org/legal/cpl-v10.html">Common Public License (CPL)</a>. In our specific project it’s not a big deal since the App in question not is subject to be distributed.</p>

<h3 id="winrun4j-solution">WinRun4J solution</h3>

<p>Both alternatives above needs a small custom Java wrapper class to handle Windows service events. Main problem to solve is launching/bootstrapping of the Spring Boot App, and Spring already has a solution in place with the <code class="language-plaintext highlighter-rouge">PropertiesLauncher</code> class.</p>

<p>With WinRun4J it’s enough to write a custom wrapper class extending an WinRun4J <code class="language-plaintext highlighter-rouge">AbstractService</code> class. A generic Spring Boot Launcher wrapper class example is demonstrated below. The magic Spring Boot launch line of code is: <code class="language-plaintext highlighter-rouge">PropertiesLauncher.main(new String[0])</code>.</p>

<p><strong>Implementation of a generic Spring Boot Wrapper</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import org.boris.winrun4j.AbstractService;
import org.boris.winrun4j.EventLog;
import org.boris.winrun4j.ServiceException;
import org.springframework.boot.loader.PropertiesLauncher;

/**
 * Winrun4j service, only to be used when deploying as a windows service.
 */
public class SpringBootLauncherService extends AbstractService {
    static final int CHECK_FOR_SHUTDOWN_INTERVAL = 6 * 1000;
    static final int PING_INTERVAL = 60 * 1000;
    
    public int serviceMain(String[] args) throws ServiceException {
        launchSpringBootApp();
        waitUntilShutdown();
        return 0;
    }

    protected void launchSpringBootApp() throws ServiceException {
        log("Launch spring boot application");
        try {
            PropertiesLauncher.main(new String[0]);
        } catch (Throwable e) {
            log(e);
            throw new ServiceException("Error while launching spring boot application", e);
        }
    }

    protected void waitUntilShutdown() {
        for (int count = 0; !isShutdown(); ) {
            try {
                Thread.sleep(CHECK_FOR_SHUTDOWN_INTERVAL);
            } catch (InterruptedException e) {}
            if (++count &gt; (PING_INTERVAL / CHECK_FOR_SHUTDOWN_INTERVAL)) {
                log("Ping");
                count = 0;
            }
        }
    }
    protected void log(String message) {
        log(false, message);
    }
    protected void log(Throwable throwable) {
        log(true, throwable.toString());
    }
    // Windows logging can be improved in WinRun4J (binary message at the time)!
    private void log(boolean error, String message) {
        EventLog.report("SpringBootLauncherService", (error ? EventLog.ERROR : EventLog.INFORMATION), message);
    }
}
</code></pre></div></div>

<h3 id="winrun4j-deploy-and-run">WinRun4J deploy and run</h3>

<p>WinRun4j provides Windows executables for 32 and 64 bit, and a deployment package contains at least the following (assembled by maven in our project)</p>

<ul>
  <li>Executable (myapp.exe)</li>
  <li>Configuration (myapp.ini)</li>
  <li>WinRun4J Jar library (with the custom Wrapper class)</li>
  <li>Application Spring Boot Jar library</li>
</ul>

<p>Installing is extremely simple:</p>

<ol>
  <li>Make sure a standard Java JRE is installed (in our case 64 bit Java 8 JRE)</li>
  <li>Unapck the files above into an App folder of your choice</li>
  <li>Configure App</li>
  <li>Install App</li>
  <li>Start App</li>
</ol>

<p><strong>Configure (myapp.ini)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>;  parameters only valid during installation
; Our Wrapper (see above)
service.class=SpringBootLauncherService
service.id=myapp
service.name=MyApp Services
service.description=More details here
service.startup=auto
; parameters valid on each startup
; Service log, probably not the application log
log=c:/Windows/Temp/myapp-service.log
log.overwrite=true
log.file.and.console=true
; Nice feature, define amount of memory in percent of available RAM
vm.heapsize.max.percent=35
; Som custom configurations overriding Spring Boot (application.yaml)
vmarg.1=-Ddb.host=localhost
; ....
classpath.1=myapp-*.jar
classpath.2=winrun4j.jar
</code></pre></div></div>

<p>The actual Spring Boot application logged to disk (logback RollingFileAppender) and also to a central syslog server, i.e. not to any native Windows log.</p>

<p><strong>Install</strong></p>

<p><em>Note: the basename of app (myapp) must be same as the basename of the ini file</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; myapp.exe --WinRun4J:RegisterService
</code></pre></div></div>

<p><strong>Start</strong></p>

<p><em>Note: Windows Services UI might also be used</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sc start myapp
</code></pre></div></div>

<p><strong>Stop</strong></p>

<p><em>Note: Windows Services UI might also be used</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sc stop myapp 
</code></pre></div></div>

<p><strong>Upgrade</strong></p>

<p>To upgrade your Spring Boot application replace the current application JAR <code class="language-plaintext highlighter-rouge">myapp-&lt;version&gt;.jar</code> and then restart (stop/start) the service.</p>

<p><strong>Uninstall</strong></p>

<p><em>Note: Reboot after to get rid of everything</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sc stop myapp
&gt; myapp.exe --WinRun4J:UnregisterService
</code></pre></div></div>

<h3 id="experiences">Experiences</h3>

<p>With a tiny written instruction the application has been successfully installed on a bunch of servers by a remote technician (with no assistance from the development team), and all seems to run without any hassle.</p>









            <div class="ce-blog-thanks">
              Tack för att du läser Callistas blogg. <br>
              Hjälp oss att nå ut med information genom att dela nyheter och artiklar i ditt nätverk.<br>
            </div>

            


    
<div class="ce-blog-share">
    <a class="ce-blog-share-element social-twitter" href="https://twitter.com/intent/tweet?text=Spring Boot App As A Windows Service&url=https://callistaenterprise.se/blogg/teknik/2015/10/09/spring-boot-app-as-a-windows-service/&via=callistaent&hashtags=" target="_blank" title="Share this post on Twitter"></a>
    <a class="ce-blog-share-element social-facebook" href="https://www.facebook.com/sharer/sharer.php?t=Spring Boot App As A Windows Service&u=https://callistaenterprise.se/blogg/teknik/2015/10/09/spring-boot-app-as-a-windows-service/" target="_blank" title="Share this post on Facebook"></a>
    <a class="ce-blog-share-element social-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Spring Boot App As A Windows Service&url=https://callistaenterprise.se/blogg/teknik/2015/10/09/spring-boot-app-as-a-windows-service/&source=http%3a%2f%2fzhangwenli.com" target="_blank" title="Share this post on LinkedIn"></a>
</div>
    
        </article>
    </div>
</section>


<section class="ce-section">
    <heading>
        <h1>Kommentarer</h1>
    </heading>
    <div class="ce-content">
        <div id="disqus_thread"></div>
        <script src="../../../../../../js/disqus.js"></script>
    </div>
</section>


    </div>

    <footer class="ce-footer">
    <div class="ce-wrapper">
        <nav class="ce-menu-footer-primary">
            <h2><a href="../../../../../../index.html">Callista</a></h2>
            <ul>
                
                <li><a href="../../../../../../om/index.html">Om oss</a></li>
                
                <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                
                <li><a href="../../../../../../event.html">Event</a></li>
                
                <li><a href="../../../../../../blogg.html">Blogg</a></li>
                
                <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                

                
                    
                        <li><a href="../../../../../../english/index.html">English</a></li>
                    
                
            </ul>
        </nav>
        <div class="ce-addresses">
            <div class="ce-address">
                <h2>Stockholm</h2>
                <address>
                    Drottninggatan 55<br>
                    111 21 Stockholm<br>
                    Tel:
                    <a href="tel:+468212142">
                        +46 8 21 21 42
                    </a>
                </address>
            </div>
            <div class="ce-address">
                <h2>Göteborg</h2>
                <address>
                    Fabriksgatan 13<br>
                    412 50 Göteborg<br>
                    Tel:
                    <a href="tel:+4631201918">
                        +46 31 20 19 18
                    </a>
                </address>
            </div>
        </div>
        <div class="ce-social">
            <h2>Följ oss</h2>
            <ul>
                <li>
                    <a href="http://twitter.com/callistaent">
                        <img alt="Twitters logotype" src="../../../../../../images/icons/twitter.png">
                        <span>@callistaent</span>
                    </a>
                </li>
            </ul>
        </div>
        <small>&copy; 2021 Callista Enterprise AB</small>
        <hr style="margin: 1em 0 2em 0">
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-raddabarnen" href="http://www.raddabarnen.se/foretag">
                <img alt="Callista är Rädda Barnens företagsvän 2021" src="../../../../../../images/logotype/rb_vanforetag_2021_large-sv.png">
            </a>
          </div>
        </div>
        <br>
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-di-gasell" href="http://www.di.se/gasell/">
              <img alt="Callista utsett till DI Gasell tre år i rad" src="../../../../../../images/logotype/di_gasell_180x194.png">
            </a>
          </div>
        </div>
    </div>
</footer>


    <script src="../../../../../../js/lib/jquery.min.js"></script>
    <script src="../../../../../../js/lib/owl.carousel.min.js"></script>
    <script src="../../../../../../js/lib/prismjs.min.js"></script>
    <script src="../../../../../../js/app.js"></script>
    <script src="../../../../../../js/analytics.js"></script>
    <script src="../../../../../../js/jobinterestsubmit.js"></script>

</body>
</html>
