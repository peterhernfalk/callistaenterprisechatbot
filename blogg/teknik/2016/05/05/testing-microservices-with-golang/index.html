<!DOCTYPE html>
<html lang="sv-se">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Callista Enterprise - seniora IT-arkitekter och systemutvecklare inom Java, öppen källkod, agil utveckling och systemintegration">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no"/>

    <link rel="icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="shortcut icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../../../../../../images/icons/callista_favicon_160x160.png">

    <title>Microservice landscape testing with Golang | Callista</title>

    <link rel="stylesheet" href="../../../../../../css/style.css%3Fv=1.css">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for callistaenterprise.se" href="../../../../../../feed.xml" />

    <!--[if lte IE 8]>
    <style>* { display: none !important; }</style>
    <meta http-equiv="refresh" content="0; url=/oldie/"/>
    <![endif]-->

    <script type="text/javascript" src="https://use.typekit.net/kig5egm.js"></script>
    <script type="text/javascript">
        try {
            Typekit.load({ async: true });
        } catch (e) {
        }
    </script>

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
     fbq('init', '804675599711872');
     fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1" src="https://www.facebook.com/tr?id=804675599711872&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->

</head>
<body>

    <header class="ce-header" data-scroll="0">
    <nav>
        <img alt="menubg" class="ce-menu-icon" style="z-index:3; top: 0px; width: 50px; height: 100%;" src="../../../../../../images/icons/menu_background.png">
        <a class="ce-logotype" href="../../../../../../index.html" style="z-index: 2;">
            <img alt="Callista" style="max-width: 100%; height: auto;" src="../../../../../../images/logotype/callista_small2.svg">
        </a>
        <table>
            <tr>
                <td>
            <ul id="menu-primary" class="ce-menu-primary">
                
                    
                            <li><a href="../../../../../../om/index.html">Om oss</a></li>
                    
                
                    
                            <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                    
                
                    
                            <li><a href="../../../../../../event.html">Event</a></li>
                    
                
                    
                        
                            <li><a class="ce-active" href="../../../../../../blogg.html">Blogg</a></li>
                        
                    
                
                    
                            <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                    
                
            </ul>
                </td>

                <td>
            <ul class="ce-menu-secondary">
                
                <li><a href="../../../../../../english/index.html">English</a></li>
                
            </ul>
                </td>
            </tr>
        </table>
            <a id="menu" class="ce-menu-icon" href="index.html#" style="z-index: 4;">
                <img alt="Visa meny" src="../../../../../../images/icons/menu.png">
            </a>
            <a class="ce-search-icon" href="index.html#">
                <img alt="Sök" src="../../../../../../images/icons/search.png">
            </a>

        </table>
    </nav>
</header>


    <div class="ce-main">
        <section class="ce-start lazyImg">
    <article>
        <h1>Blogg</h1>
        <p class="ce-ingress">
            Här finns tekniska artiklar, presentationer och nyheter om arkitektur och systemutveckling. Håll dig uppdaterad, följ oss på <a class="ce-active" href="http://twitter.com/callistaent">Twitter</a>
        </p>
    </article>
</section>

<section class="ce-section">
    <div class="ce-content">
        
        

        
        

        <article class="ce-blog">
            <header>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <img alt="Callista medarbetare Erik Lupander" src="../../../../../../assets/medarbetare/eriklupander_mini.png">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <h2>
        <a href="index.html">Microservice landscape testing with Golang</a>
        
        
    </h2>
    <h3>
        <time datetime="2016-05-05T00:00:00+00:00">
            05 May 2016
        </time>
        //
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        
        
        <a href="../../../../../../om/medarbetare/eriklupander/index.html">Erik Lupander</a>
        

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </h3>
    
</header>




<p>In this blog post, we’ll use <a href="https://golang.org/">Golang</a> to boot and test a microservice environment.</p>

<p></p>

<p>Sometimes testing a microservice environment presents challenges not typically encountered when developing more traditional applications of the monolith kind. For example, our modern microservice environment may consist of a number of containers (we’re using <a href="https://www.docker.com/">Docker</a>) each providing a service or a support function for managing the microservice landscape. In this blog post, I’ll be using the <a href="../../../../2015/06/08/building-microservices-part-4-dockerize-your-microservices/index.html">tutorial series</a> my colleague <a href="../../../../../../om/medarbetare/magnuslarsson/index.html">Magnus</a> has published on this blog and on github as our sample Microservice landscape. It consists of one public-facing service backed by several internal microservices and no less than six supporting services:</p>

<ul>
  <li>Edge server <a href="https://github.com/Netflix/zuul">Zuul</a></li>
  <li>OAuth server <a href="http://projects.spring.io/spring-security-oauth/docs/oauth2.html">Spring</a></li>
  <li>Discovery server <a href="https://github.com/Netflix/eureka">Eureka</a></li>
  <li>Config server <a href="http://cloud.spring.io/spring-cloud-static/docs/1.0.x/spring-cloud.html#_spring_cloud_config">Spring</a></li>
  <li>Monitoring <a href="https://github.com/Netflix/Hystrix">Hystrix</a></li>
  <li>Messaging <a href="https://www.rabbitmq.com/">RabbitMQ</a></li>
</ul>

<p>Want to try/run this yourself? Clone the <a href="https://github.com/callistaenterprise/blog-microservices/tree/B6">source code</a> and follow instructions in the <a href="../../../../2015/06/08/building-microservices-part-4-dockerize-your-microservices/index.html">blog post</a>!</p>

<p>Part of the challenge here is to make all these components work together, something that requires a non-trivial amount of configuration. Also, making sure things stays that way over time is equally important. Typically, you have a CI/CD pipeline to detect regressions, but with container technology it is quite easy to bootstrap all components on your developer laptop (given enough RAM). This blog post won’t go into details about the inner workings of the sample project, what I intend to show is how we can use a simple golang program to efficiently bootstrap the entire landscape using <a href="https://docs.docker.com/compose/">Docker compose</a>, wait for service availability, run a number of endpoint tests and finally shut it all down again. In other words - a very simplistic testing framework for early detection of configuration or service regressions. To accomplish this we’ll use my new favorite general-purpose non–JVM language - <a href="https://golang.org">Golang</a>!</p>

<h2 id="why-golang">Why golang?</h2>

<p>This program was actually inspired by a bash shell script and it is certainly just as easy to do this using whatever console-friendly language you prefer. I like Go due to its relative simplicity, <a href="http://stackoverflow.com/questions/2976630/why-does-go-compile-so-quickly">quick compile time</a>, <a href="https://gobyexample.com/goroutines">goroutines</a>, portability and rich set of libraries.</p>

<h2 id="how">How?</h2>

<p>It’s actually a rather trivial task, divided into a number of distinct steps:</p>

<ol>
  <li>Define how to test your landscape, we’ll use a <a href="http://yaml.org/">YAML</a> file.</li>
  <li>Build and launch the Go program, specifying the YAML file you just filled in.</li>
  <li>Await the outcome.</li>
  <li>Live long and prosper.</li>
</ol>

<h3 id="the-yaml-config-file">The YAML config file</h3>
<p>Let’s start by having a look at a sample <a href="http://yaml.org/">YAML</a> file for specifying the environment we want to boot and test:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
title: Microservices sample test file                                                #(1)
docker_compose_root: /Users/myuser/projects/microservices-workshop/solution-7        #(2)
docker_compose_file: docker-compose.yml                                              #(3)
services:                                                                            #(4)
  - http://192.168.99.100:8761
  - http://192.168.99.100:8761/eureka/apps/edgeserver
  - http://192.168.99.100:8761/eureka/apps/product
  - http://192.168.99.100:8761/eureka/apps/productapi
  - http://192.168.99.100:8761/eureka/apps/productcomposite
  - http://192.168.99.100:8761/eureka/apps/recommendation
  - http://192.168.99.100:8761/eureka/apps/review
oauth:                                                                               #(5)
  url: https://192.168.99.100:9999/uaa/oauth/token
  client_id: acme
  client_password: acmesecret
  scope: webshop
  grant_type: password
  username: user
  password: password
  token_key: access_token
endpoints:                                                                           #(6) 
- url: https://192.168.99.100/api/product/1046
  auth_method: TOKEN
- url: https://192.168.99.100/api/product/1337
  auth_method: TOKEN
- url: https://192.168.99.100/api/product/7331
  auth_method: TOKEN
</code></pre></div></div>

<p>The YAML files defines some environment specifics such as title, docker project root directory and file, what microservices to query Eureka for <em>before</em> fetching OAuth token and testing services.</p>

<ol>
  <li>Title. Used used in some console output.</li>
  <li>Absolute path to where the docker-compose.yml files lives.</li>
  <li>Name of the docker-compose yml file. Usually we stick with the default ‘docker-compose.yml’</li>
  <li>List of microservice status endpoints provided by our discovery server, in this case Eureka. All URLs must respond with a HTTP status code indicating success for a GET request before retrieving the OAuth token and commencing service testing.</li>
  <li>OAuth settings. client_id and client_password are used as HTTP Basic auth for retrieving an OAuth token for username/password. scope, grant_type and token_key are OAuth parameters.</li>
  <li>List of (micro)service endpoints to actually test. Currently only GET is supported, should add support for POST/PUT/REMOVE, request bodies, parsing etc. Note that auth_method TOKEN and NONE are the currently supported ones.</li>
</ol>

<h2 id="go-code">Go code</h2>

<p>So, how does our little golang program tie this together? I would recommend starting by taking a look directly at the main.go source file main() method:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func main() {
        CallClear() 

        // 1. Check required command-line tools are present
        // docker-compose etc.
        CheckDocker()

        // 2. Load service specification from yaml
        t := LoadSpecification()

        // 3. Start using docker-compose up -d, then use defer to make sure it's torn down afterwards.
        DockerComposeUp(t)
        defer DockerComposeDown(t)
        
        // 4. Then wait for specified microservices
        awaitServicesHasStarted(t)

        // 5. When all are started, get and store OAuth token                     
        StoreOAuthToken(t)

        // 6. execute list of endpoint HTTP calls.  (blocks until finished)
        runEndpoints(t)
}
</code></pre></div></div>

<p><em>CallClear()</em> performs a “clear” or “cls” on the executing console depending on the host OS. For the sake of clarity, I’ve omitted some console output using fancy <a href="http://www.termsys.demon.co.uk/vtansi.htm">VT100 console cursor control</a>, will return to that later.</p>

<h4 id="1-check-if-prerequisites-are-met">(1) Check if prerequisites are met</h4>

<p><em>exec.LookPath</em> is a convenience method for checking if a certain executable is present on the PATH, in this case ‘docker-compose’. If not present, we use the log.Fatal() to log and exit.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func CheckDocker() {
        _, err := exec.LookPath("docker-compose")
        if err != nil {
                log.Fatal("docker-compose not installed, fix!")
        }
        fmt.Printf("docker-compose installed OK\n")
}
</code></pre></div></div>

<h4 id="2-is-where-we-use-gopkginyamlv2-to-load-the-spec-yaml-file">(2) Is where we use gopkg.in/yaml.v2 to load the spec .yaml file.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func LoadSpecification() (TestDef) {
        spec := parseSpecFile()
        dir, _ := os.Getwd()
        dat, _ := ioutil.ReadFile(dir + "/" + spec)
        var t TestDef
        yaml.Unmarshal([]byte(dat), &amp;t)

        fmt.Println("Loaded specification '" + t.Title + "'")

        return t
}
</code></pre></div></div>

<p>Not too verbose - get the .yaml file cmd-line arg, current directory, read the file and pass a reference to an uninitialized TestDef struct into the yaml.Unmarshal method. The yaml library does all the parsing for us, allowing us to return the populated struct to the main() method.</p>

<h4 id="3-use-exec-to-run-os-commands-for-bootstrapping-our-environment">(3) Use exec to run OS commands for bootstrapping our environment.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func DockerComposeUp(t TestDef) {
        cmd := exec.Command("docker-compose", "-f", t.DockerComposeFile, "up", "-d")
        cmd.Dir = t.DockerComposeRoot
        env := os.Environ()
        env = append(env, fmt.Sprintf("PROJECT_ROOT=%s", t.DockerComposeRoot))
        cmd.Env = env
        cmd.Run()
        fmt.Println("Docker starting up using " + t.DockerComposeRoot + "/" + t.DockerComposeFile + " ...")
}
</code></pre></div></div>

<p>The <em>exec.Command</em> prepares a Cmd using varargs separated arguments to the docker-compose executable. ‘-f’ specifies the file name and ‘-d’ tells it to run in a daemon mode. Eventually, we’ll call Run() on the <em>cmd</em> instance.</p>

<p>Note how we specify the docker-compose file using a value from our testDef and how we append a PROJECT_ROOT environment variable to the env of the Cmd. Each Cmd is only active for a given Cmd so it’s <em>not</em> possible in go to first do this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     // WON'T WORK
     cmd1 := exec.Command("export", "PROJECT_ROOT=" + t.DockerComposeRoot)
     cmd1.Run()
     cmd2 := exec.Command("docker-compose", "-f", t.DockerComposeFile, "up", "-d")
     cmd2.Run()
     // WON'T WORK!!
</code></pre></div></div>

<p>In the faulty snippet above, the ‘export’ won’t carry over to cmd2, making use of such a environment variable in the docker-compose.yml yield nil, hence the use of the environment trick in the correct example further up.</p>

<h4 id="4-awaiting-service-startup">(4) Awaiting service startup</h4>

<p>How do we know when all infrastructure and services have started and is ready for testing? Our best bet is to utilize Eureka - remember these?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:                                                                            #(4)
      - http://192.168.99.100:8761
      - http://192.168.99.100:8761/eureka/apps/config-server
      ...
      - http://192.168.99.100:8761/eureka/apps/product
</code></pre></div></div>

<p>The first URL is simply the root of the Eureka service - if Eureka isn’t up we can’t check the state of services that has registered with the discover service. Under <em>http://192.168.99.100:8761/eureka/apps/[service name]</em> Eureka publishes status pages (XML) for each registered service. For our purpose, we’re OK as long as a “OK” HTTP status code is returned.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func awaitServicesHasStarted(t TestDef) {
        wg := sync.WaitGroup{}

        fmt.Println("Waiting for all microservices to start...")
        consoleRow++
        fmt.Println("")
        consoleRow++

        for _, service := range t.Services {
                wg.Add(1)
                consoleRow++
                go PollService(service, &amp;wg, len(t.Services), consoleRow)
        }
        wg.Wait()         // Blocks here until all wg.Done() has been called within PollService.

        // Fix cursor position after all services have started
        consoleRow+=3
        fmt.Printf("\033[%d;0H", consoleRow)   // Move cursor to row
}
</code></pre></div></div>

<p>Here we see some fun golang features in action, namely the <a href="https://golang.org/pkg/sync/#WaitGroup">WaitGroup</a> and the <a href="https://golang.org/ref/spec#Go_statements">go</a> keyword. What this snippet does is that it will spawn t.Services number of goroutines executing the PollService method. For each “go” wg.Add(1) tells the waitgroup to increment the number of future wg.Done() it needs to receive until continuing processing after wg.Wait().</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func PollService(service string, wg *sync.WaitGroup, total int, consoleRow int) {

        Cprint(consoleRow, 0, service)
        Cprint(consoleRow, 60, "... waiting ")

        req, _ := http.NewRequest("GET", service, nil)
        var DefaultTransport http.RoundTripper = &amp;http.Transport{
                TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},
        }

        for {
                resp, err := DefaultTransport.RoundTrip(req)
                if err != nil || resp.StatusCode &gt; 299 {
                        Cprint(consoleRow, 0, service)
                        Cprint(consoleRow, 60, "... waiting ")
                }  else {
                        Cprint(consoleRow, 0, service)
                        Cprint(consoleRow, 60, "done                   ")
                        wg.Done()
                        return
                }
                time.Sleep(time.Second * 1)
        }
}
</code></pre></div></div>

<p>Ignore all the Cprint calls for now, they’re just for the VT100-style console output. The important part is the HTTP GET requests performed using net/http’s DefaultTransport. DefaultTransport? Why not use the standard net/http client golang provides? Well - the easiest way of having golang’s net/http client to accept servers with self-signed certificates is by setting the TLSClientConfig seen in the code.</p>

<p>Apart from the cert fix (and the ugly Cprint statements), the program will keep looping issuing one request per second to whatever Url that was specified in the <em>service</em> parameter until a &lt; 299 HTTP status is returned.</p>

<p>For example, <em>http://192.168.99.100:8761</em> - which in our microservice landscape is the Eureka start page - won’t return 200 OK until the Eureka service is up and running. Somewhat later, the “Product service” status can be queried by asking Eureka it’s state at the <em>http://192.168.99.100:8761/eureka/apps/product</em>. So remember, it is not the actual service endpoint we are checking, we are just making sure it has booted and registered itself with its discovery service.</p>

<h4 id="5-testing-services">(5) Testing services</h4>
<p>Actual endpoint testing is probably much more complex in a real-world scenario than here - you’d want full support for other HTTP methods, POST bodies, headers, response parsing etc. - which is out of scope for this little exercise. The service testing code (e.g. runEndpoints) is actually very similar to the PollService one, with the difference that we’re adding a HTTP header with whatever OAuth token our request to <a href="https://github.com/eriklupander/microservicetester/blob/master/src/github.com/eriklupander/mstest/oauthtoken.go">StoreOAuthToken</a> function yielded:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>req := BuildHttpRequest(endpoint.Url, endpoint.Method)
var DefaultTransport http.RoundTripper = &amp;http.Transport{
        TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},
}
if endpoint.Auth_method == "TOKEN" {
    req.Header.Add("Authorization", "Bearer " + TOKEN)
}
</code></pre></div></div>

<p>We then try each service up to 10 times before giving up:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>retries := 10
for i := 0; i &lt; retries; i++ {
        
        resp, err := DefaultTransport.RoundTrip(req)

        if err != nil || resp.StatusCode &gt; 299 {
                Cprint(consoleRow, 0, endpoint.Url)
                Cprint(consoleRow, 70, "... failed. Retrying " + strconv.Itoa(i) + "/" + strconv.Itoa(retries) + " ...            ")
        } else {
                Cprint(consoleRow, 0, endpoint.Url)
                Cprint(consoleRow, 70, "... OK                                          ")
                wg2.Done()
                break
        }
        time.Sleep(time.Second * 3)

        if (i == retries - 1) {
                wg2.Done()
                Cprint(consoleRow, 0, endpoint.Url)
                Cprint(consoleRow, 70, "... All attempts failed, something is broken.                                 ")
        }
}
</code></pre></div></div>

<p>Again, we use a WaitGroup to make sure each goroutine can finish before the program exits.</p>

<h4 id="console-printing-with-cursor-control">Console printing with cursor control</h4>
<p>Finally, the little CPrint method used to output program state to the console window:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var l sync.Mutex

func Cprint(row int, col int, text string) {
        l.Lock()
        fmt.Printf("\033[%d;%dH", row, col)
        fmt.Print(text)
        l.Unlock()
}
</code></pre></div></div>

<p>We’re simply using Printf with the VT100 escape sequence for positioning the cursor and row/col and then printing text. Since each goroutine may call this code to update console output at any time we need to use a lock mechanism or the output will become really garbled. Alternatively, we could have used a sync go channel instead, see bottom of this blog post for an example.</p>

<h2 id="running-it">Running it</h2>
<p>Below, we have a sample output from a run.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; go run src/github.com/eriklupander/mstest/*.go spec.yml

Starting up...
docker-compose installed OK
Loaded specification 'Microservices sample test file'
Docker starting up using /Users/eriklupander/privat/blog-microservices/docker-compose.yml ...
Waiting for all microservices to start...


http://192.168.99.100:8761                                 done                   
http://192.168.99.100:8761/eureka/apps/edgeserver          done                   
http://192.168.99.100:8761/eureka/apps/product             done                   
http://192.168.99.100:8761/eureka/apps/productapi          done                   
http://192.168.99.100:8761/eureka/apps/productcomposite    done                   
http://192.168.99.100:8761/eureka/apps/recommendation      done                   
http://192.168.99.100:8761/eureka/apps/review              done                   

Getting OAuth token ... OK

https://192.168.99.100/api/product/1046                              ... OK                                          
https://192.168.99.100/api/product/1337                              ... OK                                          
https://192.168.99.100/api/product/7331                              ... OK                                          

All done.
Docker shutting down...
</code></pre></div></div>

<h2 id="bonus-content-concurrent-console-output-using-channel">Bonus content: Concurrent console output using channel</h2>
<p>Bonus snippet of code using Go channels for handling (synchronized) console printing without explicit use of mutexes and/or locks.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var consoleChannel chan CText                   // Declare privately scoped channel that we can pass console print
                                                // statements to
func init() {
    // Maybe some other stuff
    
    go pollConsoleChannel()                     // Start a goroutine that will handle receives on the channel
}

func pollConsoleChannel() {
        consoleChannel = make(chan CText)       // Instantiate unbuffered (e.g. sync) channel
        
        // Will iterate until main program exits, blocks at &lt;-.
        for {
                msg := &lt;- consoleChannel                          // Blocks here until a message is received.
                fmt.Printf("\033[%d;%dH", msg.Row, msg.Col)       // Position cursor
                fmt.Print(msg.Text)                               // Prints text at cursor position
        }
}

/* Application invokes this func to print to console */
func ChPrint(row int, col int, text string) {
        
        msg := CText{                // Build a simple instance of the CText struct
                row,
                col,
                text,
        }
        consoleChannel &lt;- msg        // Submit message on channel
}

/* Simple struct for encapsulating row, col and text to log */
type CText struct {
        Row int
        Col int
        Text string
}
</code></pre></div></div>









            <div class="ce-blog-thanks">
              Tack för att du läser Callistas blogg. <br>
              Hjälp oss att nå ut med information genom att dela nyheter och artiklar i ditt nätverk.<br>
            </div>

            


    
<div class="ce-blog-share">
    <a class="ce-blog-share-element social-twitter" href="https://twitter.com/intent/tweet?text=Testing Microservices With Golang&url=https://callistaenterprise.se/blogg/teknik/2016/05/05/testing-microservices-with-golang/&via=callistaent&hashtags=" target="_blank" title="Share this post on Twitter"></a>
    <a class="ce-blog-share-element social-facebook" href="https://www.facebook.com/sharer/sharer.php?t=Testing Microservices With Golang&u=https://callistaenterprise.se/blogg/teknik/2016/05/05/testing-microservices-with-golang/" target="_blank" title="Share this post on Facebook"></a>
    <a class="ce-blog-share-element social-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Testing Microservices With Golang&url=https://callistaenterprise.se/blogg/teknik/2016/05/05/testing-microservices-with-golang/&source=http%3a%2f%2fzhangwenli.com" target="_blank" title="Share this post on LinkedIn"></a>
</div>
    
        </article>
    </div>
</section>


<section class="ce-section">
    <heading>
        <h1>Kommentarer</h1>
    </heading>
    <div class="ce-content">
        <div id="disqus_thread"></div>
        <script src="../../../../../../js/disqus.js"></script>
    </div>
</section>


    </div>

    <footer class="ce-footer">
    <div class="ce-wrapper">
        <nav class="ce-menu-footer-primary">
            <h2><a href="../../../../../../index.html">Callista</a></h2>
            <ul>
                
                <li><a href="../../../../../../om/index.html">Om oss</a></li>
                
                <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                
                <li><a href="../../../../../../event.html">Event</a></li>
                
                <li><a href="../../../../../../blogg.html">Blogg</a></li>
                
                <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                

                
                    
                        <li><a href="../../../../../../english/index.html">English</a></li>
                    
                
            </ul>
        </nav>
        <div class="ce-addresses">
            <div class="ce-address">
                <h2>Stockholm</h2>
                <address>
                    Drottninggatan 55<br>
                    111 21 Stockholm<br>
                    Tel:
                    <a href="tel:+468212142">
                        +46 8 21 21 42
                    </a>
                </address>
            </div>
            <div class="ce-address">
                <h2>Göteborg</h2>
                <address>
                    Fabriksgatan 13<br>
                    412 50 Göteborg<br>
                    Tel:
                    <a href="tel:+4631201918">
                        +46 31 20 19 18
                    </a>
                </address>
            </div>
        </div>
        <div class="ce-social">
            <h2>Följ oss</h2>
            <ul>
                <li>
                    <a href="http://twitter.com/callistaent">
                        <img alt="Twitters logotype" src="../../../../../../images/icons/twitter.png">
                        <span>@callistaent</span>
                    </a>
                </li>
            </ul>
        </div>
        <small>&copy; 2021 Callista Enterprise AB</small>
        <hr style="margin: 1em 0 2em 0">
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-raddabarnen" href="http://www.raddabarnen.se/foretag">
                <img alt="Callista är Rädda Barnens företagsvän 2021" src="../../../../../../images/logotype/rb_vanforetag_2021_large-sv.png">
            </a>
          </div>
        </div>
        <br>
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-di-gasell" href="http://www.di.se/gasell/">
              <img alt="Callista utsett till DI Gasell tre år i rad" src="../../../../../../images/logotype/di_gasell_180x194.png">
            </a>
          </div>
        </div>
    </div>
</footer>


    <script src="../../../../../../js/lib/jquery.min.js"></script>
    <script src="../../../../../../js/lib/owl.carousel.min.js"></script>
    <script src="../../../../../../js/lib/prismjs.min.js"></script>
    <script src="../../../../../../js/app.js"></script>
    <script src="../../../../../../js/analytics.js"></script>
    <script src="../../../../../../js/jobinterestsubmit.js"></script>

</body>
</html>
