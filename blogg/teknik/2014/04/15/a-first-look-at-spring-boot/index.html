<!DOCTYPE html>
<html lang="sv-se">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Callista Enterprise - seniora IT-arkitekter och systemutvecklare inom Java, öppen källkod, agil utveckling och systemintegration">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no"/>

    <link rel="icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="shortcut icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../../../../../../images/icons/callista_favicon_160x160.png">

    <title>A first look at Spring Boot, is it time to leave XML based configuration behind? | Callista</title>

    <link rel="stylesheet" href="../../../../../../css/style.css%3Fv=1.css">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for callistaenterprise.se" href="../../../../../../feed.xml" />

    <!--[if lte IE 8]>
    <style>* { display: none !important; }</style>
    <meta http-equiv="refresh" content="0; url=/oldie/"/>
    <![endif]-->

    <script type="text/javascript" src="https://use.typekit.net/kig5egm.js"></script>
    <script type="text/javascript">
        try {
            Typekit.load({ async: true });
        } catch (e) {
        }
    </script>

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
     fbq('init', '804675599711872');
     fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1" src="https://www.facebook.com/tr?id=804675599711872&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->

</head>
<body>

    <header class="ce-header" data-scroll="0">
    <nav>
        <img alt="menubg" class="ce-menu-icon" style="z-index:3; top: 0px; width: 50px; height: 100%;" src="../../../../../../images/icons/menu_background.png">
        <a class="ce-logotype" href="../../../../../../index.html" style="z-index: 2;">
            <img alt="Callista" style="max-width: 100%; height: auto;" src="../../../../../../images/logotype/callista_small2.svg">
        </a>
        <table>
            <tr>
                <td>
            <ul id="menu-primary" class="ce-menu-primary">
                
                    
                            <li><a href="../../../../../../om/index.html">Om oss</a></li>
                    
                
                    
                            <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                    
                
                    
                            <li><a href="../../../../../../event.html">Event</a></li>
                    
                
                    
                        
                            <li><a class="ce-active" href="../../../../../../blogg.html">Blogg</a></li>
                        
                    
                
                    
                            <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                    
                
            </ul>
                </td>

                <td>
            <ul class="ce-menu-secondary">
                
                <li><a href="../../../../../../english/index.html">English</a></li>
                
            </ul>
                </td>
            </tr>
        </table>
            <a id="menu" class="ce-menu-icon" href="index.html#" style="z-index: 4;">
                <img alt="Visa meny" src="../../../../../../images/icons/menu.png">
            </a>
            <a class="ce-search-icon" href="index.html#">
                <img alt="Sök" src="../../../../../../images/icons/search.png">
            </a>

        </table>
    </nav>
</header>


    <div class="ce-main">
        <section class="ce-start lazyImg">
    <article>
        <h1>Blogg</h1>
        <p class="ce-ingress">
            Här finns tekniska artiklar, presentationer och nyheter om arkitektur och systemutveckling. Håll dig uppdaterad, följ oss på <a class="ce-active" href="http://twitter.com/callistaent">Twitter</a>
        </p>
    </article>
</section>

<section class="ce-section">
    <div class="ce-content">
        
        

        
        

        <article class="ce-blog">
            <header>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <img alt="Callista medarbetare Magnus Larsson" src="../../../../../../assets/medarbetare/magnuslarsson_mini.png">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <h2>
        <a href="index.html">A first look at Spring Boot, is it time to leave XML based configuration behind?</a>
        
        
    </h2>
    <h3>
        <time datetime="2014-04-15T00:00:00+00:00">
            15 April 2014
        </time>
        //
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        
        
        <a href="../../../../../../om/medarbetare/magnuslarsson/index.html">Magnus Larsson</a>
        

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </h3>
    
</header>




<p><a href="http://projects.spring.io/spring-boot/">Spring Boot</a> makes it very easy to create Spring based applications. Spring Boot takes an opinionated view of the Spring platform and third-party libraries, allowing us to get started with a minimal configuration. For example we can develop a Jave EE based web application without any configuration files. Not even a <code class="language-plaintext highlighter-rouge">web.xml</code> file is required!</p>

<p></p>

<p>When required, however, we can take control over parts of the configuration and override the conventions that Spring Boot puts in play. We can also, if we really must, use traditional XML configuration files for some parts of the configuration. Please read the excellent <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/">documentation</a> for extensive information.</p>

<p>In this blog we will develop a plain REST service using the <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html">Spring Web MVC framework</a> (shortened to <em>Spring MVC</em> in this blog) and package it in a web application, ready to be deployed in any Servlet 3.0 compliant web server. We will also, of course, do it a test run in the embedded Servlet container that Spring Boot provides. We are going to use <a href="../../14/a-first-look-at-gradle/index.html">Gradle</a> as our build system.</p>

<h2 id="get-the-source-code">Get the source code</h2>
<p>If you want to check out the source code and test it on your own you need to have Java SE 7 and Git installed. Then perform:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone git@github.com:callistaenterprise/blog-a-first-look-at-spring-boot.git
$ cd blog-a-first-look-at-spring-boot/spring-boot-one
$ tree
</code></pre></div></div>

<p>This should result in a tree structure like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
└── src
    └── main
        ├── java
        │   └── se
        │       └── callista
        │           └── springbootone
        │               ├── Application.java
        │               ├── MyEmbeddedServletContainerCustomizer.java
        │               ├── ProcessingController.java
        │               └── ProcessingStatus.java
        └── resources
            ├── application.properties
            └── logback.xml
</code></pre></div></div>

<h2 id="walk-through-of-the-source-code">Walk through of the source code</h2>
<p>Let’s start with defining a vanilla REST Service using Spring MVC, next we look at the “magic” Spring Boot Application class and the Gradle build file that also is of great importance. We will wrap up the walk through with looking as some examples of how you easily can override the conventions that Spring Boot puts in play.</p>

<h3 id="a-rest-service">A REST service</h3>
<p>The REST service is implemented as a vanilla Spring MVC Rest-controller. The service takes two query parameters, <code class="language-plaintext highlighter-rouge">minMs</code> and <code class="language-plaintext highlighter-rouge">maxMs</code>, that defines the boundaries of the processing time of the service. The service will simulate a response time between the given boundaries by using <code class="language-plaintext highlighter-rouge">Thread.sleep()</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">se.callista.springbootone</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">...</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcessingController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ProcessingController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/process"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">ProcessingStatus</span> <span class="nf">blockingProcessing</span><span class="o">(</span>
    <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"minMs"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">minMs</span><span class="o">,</span>
    <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"maxMs"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">maxMs</span><span class="o">)</span> <span class="o">{</span>

    <span class="kt">int</span> <span class="n">processingTimeMs</span> <span class="o">=</span> <span class="n">calculateProcessingTime</span><span class="o">(</span><span class="n">minMs</span><span class="o">,</span> <span class="n">maxMs</span><span class="o">);</span>

    <span class="no">LOG</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Start request, processing time: {} ms."</span><span class="o">,</span> <span class="n">processingTimeMs</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">processingTimeMs</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
    <span class="k">finally</span> <span class="o">{</span>
      <span class="no">LOG</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Processing of request done"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">ProcessingStatus</span><span class="o">(</span><span class="s">"Ok"</span><span class="o">,</span> <span class="n">processingTimeMs</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">calculateProcessingTime</span><span class="o">(</span><span class="kt">int</span> <span class="n">minMs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxMs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">maxMs</span> <span class="o">&lt;</span> <span class="n">minMs</span><span class="o">)</span> <span class="n">maxMs</span> <span class="o">=</span> <span class="n">minMs</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">processingTimeMs</span> <span class="o">=</span> <span class="n">minMs</span> <span class="o">+</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="o">(</span><span class="n">maxMs</span> <span class="o">-</span> <span class="n">minMs</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">processingTimeMs</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">RestController</code> annotation makes the code REST aware and the <code class="language-plaintext highlighter-rouge">RequestMapping</code> annotation declares what URI the service should be mapped to. As you can see the service return an instance of the class <code class="language-plaintext highlighter-rouge">ProcessingStatus</code>. It is a POJO-class that looks like:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">se.callista.springbootone</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">...</span>

<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProcessingStatus</span> <span class="o">{</span>

  <span class="nd">@XmlElement</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">status</span><span class="o">;</span>

  <span class="nd">@XmlElement</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">processingTimeMs</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">ProcessingStatus</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">"UNKNOWN"</span><span class="o">;</span>
    <span class="n">processingTimeMs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">ProcessingStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">status</span><span class="o">,</span> <span class="kt">int</span> <span class="n">processingTimeMs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">processingTimeMs</span> <span class="o">=</span> <span class="n">processingTimeMs</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getProcessingTimeMs</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">processingTimeMs</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Spring MVC will automatically marshal the <code class="language-plaintext highlighter-rouge">ProcessingStatus</code> object to  either JSON or XML depending on what the client requests in the HTTP  Accept header, by default JSON will be used. To have the XML processing automated we need the XML annotations <code class="language-plaintext highlighter-rouge">XmlRootElement</code> and <code class="language-plaintext highlighter-rouge">XmlElement</code> plus that JAXB is available on the classpath (we  will ensure that in our build-file, see below).</p>

<h3 id="the-magic-spring-boot-application-class">The “magic” Spring Boot Application class</h3>
<p>Here is where all the magic happens that for example removes the burden of developing and maintaining XML configuration files!</p>

<p>The source code required to do that looks like:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">se.callista.springbootone</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">...</span>

<span class="nd">@ComponentScan</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>That is not that much source code, right?</p>

<p>The <code class="language-plaintext highlighter-rouge">ComponentScan</code> annotation tells Spring to look for REST controllers in our code.</p>

<p>The <code class="language-plaintext highlighter-rouge">EnableAutoConfiguration</code> annotation tells Spring Boot to “guess” how you want to configure Spring, based on the dependencies we have in our build file. In this case it will figure out that we want to build a web app and run it on an embedded Tomcat instance with Spring MVC enabled (e.g. configuration of a DispatcherServlet).</p>

<p>Let’s look into the build file to understand that a bit more…</p>

<h2 id="the-build-file">The build file</h2>
<p>As mentioned earlier we use Gradle as our build system. It gives us a much more compact and easier to maintain build file compared to using Maven. Please see the this <a href="../../14/a-first-look-at-gradle/index.html">blog about Gradle</a> if you want to know more.</p>

<p>The build file, <code class="language-plaintext highlighter-rouge">build.gradle</code>, looks like:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buildscript</span> <span class="o">{</span>
  <span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
  <span class="o">}</span>
  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">classpath</span><span class="o">(</span><span class="s2">"org.springframework.boot:spring-boot-gradle-plugin:1.0.0.RELEASE"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'eclipse'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'idea'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'spring-boot'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'war'</span>

<span class="n">war</span> <span class="o">{</span>
  <span class="n">baseName</span> <span class="o">=</span> <span class="s1">'spring-boot-one'</span>
  <span class="n">version</span> <span class="o">=</span>  <span class="s1">'1.0.0-SNAPSHOT'</span>
<span class="o">}</span>

<span class="n">repositories</span> <span class="o">{</span>
  <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span><span class="o">(</span><span class="s2">"org.springframework.boot:spring-boot-starter-web"</span><span class="o">)</span>
  <span class="c1">// compile("org.springframework.boot:spring-boot-starter-jetty")</span>
  <span class="n">compile</span><span class="o">(</span><span class="s2">"org.springframework.boot:spring-boot-starter-actuator"</span><span class="o">)</span>
  <span class="n">compile</span><span class="o">(</span><span class="s2">"javax.xml.bind:jaxb-api:2.1"</span><span class="o">)</span>
  <span class="n">compile</span><span class="o">(</span><span class="s2">"com.sun.xml.bind:jaxb-impl:2.1.9"</span><span class="o">)</span>
  <span class="n">testCompile</span><span class="o">(</span><span class="s2">"org.springframework.boot:spring-boot-starter-test"</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">wrapper</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Wrapper</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">gradleVersion</span> <span class="o">=</span> <span class="s1">'1.11'</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>First we declare that we want to use v1.0.0 of the Spring Boot Gradle-plugin</li>
  <li>Next we applies a number of plugins, specifically the spring-boot and war plugins</li>
  <li>Finally we setup a number of dependencies:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">spring-boot-starter-web</code> drags in a convenient set of dependencies for building web applications, e.g. Spring Framework, Spring MVC, the Servlet API and embedded Tomcat.</li>
      <li><code class="language-plaintext highlighter-rouge">spring-boot-starter-jetty</code> can be used to replace Tomcat with Jetty as our embedded Servlet container (disabled for the moment)</li>
      <li><code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> adds some interesting out-of-the-box features for metrics and monitoring</li>
      <li><code class="language-plaintext highlighter-rouge">jaxb-api</code> and <code class="language-plaintext highlighter-rouge">jaxb-impl</code> enables, as described above, our REST controller to automatically marshal our result to XML if so requested by the caller</li>
      <li><code class="language-plaintext highlighter-rouge">spring-boot-starter-test</code> drags in a convenient set of test dependencies, such as JUnit, Mockito and Hamcrest</li>
    </ul>
  </li>
</ul>

<p><strong>Note #1:</strong> The version of the Spring Boot Gradle-plugin decides the versions of the <code class="language-plaintext highlighter-rouge">spring-boot-starter-*</code> dependencies.</p>

<p><strong>Note #2:</strong> The <code class="language-plaintext highlighter-rouge">spring-boot-starter-*</code> dependencies are very convenient to use but if they don’t suite your specific needs you can easily replace them with your own. They are only a set of prepackaged “pom type” dependencies that Spring Boot puts together for you, for example see <a href="http://central.maven.org/maven2/org/springframework/boot/spring-boot-starter-web/1.0.0.RELEASE/spring-boot-starter-web-1.0.0.RELEASE.pom">spring-boot-starter-web v1.0.0</a>.</p>

<h2 id="override-some-of-the-conventions">Override some of the conventions</h2>
<p>First, if you want to reuse some of your existing XML configuration files you can simply load them using an <code class="language-plaintext highlighter-rouge">ImportResource</code> annotation or as the Spring Boot Reference Guide states in <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-configuration-classes.html#using-boot-importing-xml-configuration">§14.2 Importing XML configuration</a>:</p>

<blockquote>
  <p>If you absolutely must use XML based configuration, we recommend that you still start with a <code class="language-plaintext highlighter-rouge">@Configuration</code> class. You can then use an additional <code class="language-plaintext highlighter-rouge">@ImportResource</code> annotation to load XML configuration files.</p>
</blockquote>

<p>No doubt on what direction the Spring Boot people wants you to go :-)</p>

<p>Now over to a sample Java based configuration. I want to be able to use this code example for some load testing and therefore I want to be able to configure the embedded Tomcat runtime environment, e.g. adjusting the max number of threads in the request thread pool. I can do that by defining a <code class="language-plaintext highlighter-rouge">EmbeddedServletContainerCustomizer</code> - bean in my <code class="language-plaintext highlighter-rouge">Application.java</code> - class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">EmbeddedServletContainerCustomizer</span> <span class="nf">embeddedServletCustomizer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MyEmbeddedServletContainerCustomizer</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>The implementation looks like:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">se.callista.springbootone</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEmbeddedServletContainerCustomizer</span> <span class="kd">implements</span> <span class="nc">EmbeddedServletContainerCustomizer</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span>
      <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">MyEmbeddedServletContainerCustomizer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${servlet.container.maxThreads}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="no">MAX_THREADS</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customize</span><span class="o">(</span><span class="nc">ConfigurableEmbeddedServletContainer</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">factory</span> <span class="k">instanceof</span> <span class="nc">TomcatEmbeddedServletContainerFactory</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">customizeTomcat</span><span class="o">((</span><span class="nc">TomcatEmbeddedServletContainerFactory</span><span class="o">)</span> <span class="n">factory</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customizeTomcat</span><span class="o">(</span><span class="nc">TomcatEmbeddedServletContainerFactory</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">addConnectorCustomizers</span><span class="o">(</span><span class="k">new</span> <span class="nc">TomcatConnectorCustomizer</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customize</span><span class="o">(</span><span class="nc">Connector</span> <span class="n">connector</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">defaultMaxThreads</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"maxThreads"</span><span class="o">);</span>
        <span class="n">connector</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"maxThreads"</span><span class="o">,</span> <span class="no">MAX_THREADS</span><span class="o">);</span>
        <span class="no">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Changed Tomcat connector maxThreads from "</span> <span class="o">+</span>
            <span class="n">defaultMaxThreads</span> <span class="o">+</span> <span class="s">" to "</span> <span class="o">+</span> <span class="no">MAX_THREADS</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">customize()</code> - method checks if we are using Tomcat and if so it delegates the settings to the method <code class="language-plaintext highlighter-rouge">customizeTomcat()</code> that use Tomcat specific API’s to set the <code class="language-plaintext highlighter-rouge">MaxThreads</code> property.</p>

<p>You can also see that we have avoided to hard code the new <code class="language-plaintext highlighter-rouge">MaxThreads</code> value but instead used property injection. The value of the property <code class="language-plaintext highlighter-rouge">servlet.container.maxThreads</code> can be found in the file  <code class="language-plaintext highlighter-rouge">src/main/resources/application.properties</code>, standardised by Spring Boot. It looks like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server.port = 9090
servlet.container.maxThreads=500
</code></pre></div></div>

<p>As you might already have guessed the other property server.port is another Spring Boot convention for setting the HTTP port for the embedded Servlet container.</p>

<h2 id="a-test-run">A test run!</h2>
<p>Ok, now we are ready to see if this works!</p>

<p>Let’s begin with building the war-file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./gradlew build
</code></pre></div></div>

<p>You will find the war-file in the folder <code class="language-plaintext highlighter-rouge">build/libs</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build
└── libs
    └── spring-boot-one-1.0.0-SNAPSHOT.war
</code></pre></div></div>

<p>Start the web app in an embedded Tomcat instance with the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./gradlew bootRun
</code></pre></div></div>

<p>It should result in something like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:: Spring Boot ::        (v1.0.0.RELEASE)
.
.
.
2014-04-03 21:41:47 INFO  main o.a.c.c.StandardService:183 - Starting service Tomcat
2014-04-03 21:41:47 INFO  main o.a.c.c.StandardEngine:183 - Starting Servlet Engine: Apache Tomcat/7.0.52
2014-04-03 21:41:47 INFO  localhost-startStop-1 o.a.c.c.C.[.[.[/]:183 - Initializing Spring embedded WebApplicationContext
.
.
.
2014-04-03 21:41:48 INFO  main o.s.b.c.e.t.TomcatEmbeddedServletContainer:139 - Tomcat started on port(s): 9090/http
2014-04-03 21:41:48 INFO  main s.c.w.s.a.t.Application:61 - Started Application in 2.755 seconds (JVM running for 3.55)
</code></pre></div></div>

<p>Now try out the REST service with a command like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -i "http://localhost:9090/process?minMs=1000&amp;maxMs=2000"

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
X-Application-Context: application:9090
Content-Type: application/json;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 03 Apr 2014 19:47:22 GMT

{"status":"Ok","processingTimeMs":1374}
</code></pre></div></div>

<p>Here we ask the REST service to process our request and respond  in between 1 and 2 secs. The response comes from Tomcat (Apache Coyote  means Tomcat) in a json-format. The json-response reports that the  internal processing actually took 1374 ms.</p>

<p>Let’s try to ask for a response in XML format this time:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -H "accept:application/xml" "http://localhost:9090/process?minMs=1000&amp;maxMs=2000"

&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
 &lt;processingStatus&gt;
  &lt;status&gt;Ok&lt;/status&gt;
  &lt;processingTimeMs&gt;1034&lt;/processingTimeMs&gt;
&lt;/processingStatus&gt;
</code></pre></div></div>

<p>That worked pretty good as well.</p>

<p>Shall we try another web server?</p>

<p>Open the file <code class="language-plaintext highlighter-rouge">build.gradle</code> in a text editor and uncomment the  dependency to <code class="language-plaintext highlighter-rouge">spring-boot-starter-jetty</code>. Restart the web-app and look  for the following in the output from the startup:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2014-04-03 22:02:28 INFO  main o.e.j.s.Server:272 - jetty-8.1.14.v20131031
2014-04-03 22:02:29 INFO  main o.s.b.c.e.j.JettyEmbeddedServletContainer:97 - Jetty started on port: 9090
</code></pre></div></div>

<p>Seems like SpringBoot deployed our web app in an embedded Jetty container, try it out and look for Jetty in the server-information:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -i "http://localhost:9090/process?minMs=1000&amp;maxMs=2000"

HTTP/1.1 200 OK
X-Application-Context: application:9090
Content-Type: application/json;charset=UTF-8
Transfer-Encoding: chunked
Server: Jetty(8.1.14.v20131031)

{"status":"Ok","processingTimeMs":1007}
</code></pre></div></div>

<p>Great!</p>

<p>Let’s wrap up the test run with a quick look at what the <code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> dependency gives us out-of-the-box. First fire off a number of calls to the REST service and then give the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl localhost:9090/metrics/counter.status.200.process
12
</code></pre></div></div>

<p>Ok, so we have made twelve calls to the service. No try out:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl localhost:9090/metrics/gauge.response.process
1821.0
</code></pre></div></div>

<p>…and we get some metrics regarding the response time of our service. Without writing a single line of code!</p>

<p>An impressive test run, right?</p>

<h2 id="ide-integration">IDE integration</h2>
<p>So far we have been doing everything on the command line, but you can of course import the project into a IDE that supports Gradle, e.g. Eclipse or IntelliJ. Below is a screen shot from my favorite IDE, IntelliJ, where I have Spring Boot running in one sub window and a Terminal in another sub window where I run my test commands:</p>

<p><img src="../../../../../../assets/blogg/a-first-look-at-spring-boot/springboot-in-intellij.png" alt="" /></p>

<h2 id="summary">Summary</h2>
<p>Getting started with a Spring project, specifically when based on Java EE, has never been this easy! With Spring Boot you can get a new application up and running in a few minutes and, at least initially, disregarding all questions related to deployment descriptors and configuration files. When required you can take control over the conventions Spring Boot puts in play and refine parts of the configuration to meet your needs!</p>

<p>I can only encourage you to try this out in your next Spring project!</p>









            <div class="ce-blog-thanks">
              Tack för att du läser Callistas blogg. <br>
              Hjälp oss att nå ut med information genom att dela nyheter och artiklar i ditt nätverk.<br>
            </div>

            


    
<div class="ce-blog-share">
    <a class="ce-blog-share-element social-twitter" href="https://twitter.com/intent/tweet?text=A First Look At Spring Boot&url=https://callistaenterprise.se/blogg/teknik/2014/04/15/a-first-look-at-spring-boot/&via=callistaent&hashtags=" target="_blank" title="Share this post on Twitter"></a>
    <a class="ce-blog-share-element social-facebook" href="https://www.facebook.com/sharer/sharer.php?t=A First Look At Spring Boot&u=https://callistaenterprise.se/blogg/teknik/2014/04/15/a-first-look-at-spring-boot/" target="_blank" title="Share this post on Facebook"></a>
    <a class="ce-blog-share-element social-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=A First Look At Spring Boot&url=https://callistaenterprise.se/blogg/teknik/2014/04/15/a-first-look-at-spring-boot/&source=http%3a%2f%2fzhangwenli.com" target="_blank" title="Share this post on LinkedIn"></a>
</div>
    
        </article>
    </div>
</section>


<section class="ce-section">
    <heading>
        <h1>Kommentarer</h1>
    </heading>
    <div class="ce-content">
        <div id="disqus_thread"></div>
        <script src="../../../../../../js/disqus.js"></script>
    </div>
</section>


    </div>

    <footer class="ce-footer">
    <div class="ce-wrapper">
        <nav class="ce-menu-footer-primary">
            <h2><a href="../../../../../../index.html">Callista</a></h2>
            <ul>
                
                <li><a href="../../../../../../om/index.html">Om oss</a></li>
                
                <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                
                <li><a href="../../../../../../event.html">Event</a></li>
                
                <li><a href="../../../../../../blogg.html">Blogg</a></li>
                
                <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                

                
                    
                        <li><a href="../../../../../../english/index.html">English</a></li>
                    
                
            </ul>
        </nav>
        <div class="ce-addresses">
            <div class="ce-address">
                <h2>Stockholm</h2>
                <address>
                    Drottninggatan 55<br>
                    111 21 Stockholm<br>
                    Tel:
                    <a href="tel:+468212142">
                        +46 8 21 21 42
                    </a>
                </address>
            </div>
            <div class="ce-address">
                <h2>Göteborg</h2>
                <address>
                    Fabriksgatan 13<br>
                    412 50 Göteborg<br>
                    Tel:
                    <a href="tel:+4631201918">
                        +46 31 20 19 18
                    </a>
                </address>
            </div>
        </div>
        <div class="ce-social">
            <h2>Följ oss</h2>
            <ul>
                <li>
                    <a href="http://twitter.com/callistaent">
                        <img alt="Twitters logotype" src="../../../../../../images/icons/twitter.png">
                        <span>@callistaent</span>
                    </a>
                </li>
            </ul>
        </div>
        <small>&copy; 2021 Callista Enterprise AB</small>
        <hr style="margin: 1em 0 2em 0">
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-raddabarnen" href="http://www.raddabarnen.se/foretag">
                <img alt="Callista är Rädda Barnens företagsvän 2021" src="../../../../../../images/logotype/rb_vanforetag_2021_large-sv.png">
            </a>
          </div>
        </div>
        <br>
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-di-gasell" href="http://www.di.se/gasell/">
              <img alt="Callista utsett till DI Gasell tre år i rad" src="../../../../../../images/logotype/di_gasell_180x194.png">
            </a>
          </div>
        </div>
    </div>
</footer>


    <script src="../../../../../../js/lib/jquery.min.js"></script>
    <script src="../../../../../../js/lib/owl.carousel.min.js"></script>
    <script src="../../../../../../js/lib/prismjs.min.js"></script>
    <script src="../../../../../../js/app.js"></script>
    <script src="../../../../../../js/analytics.js"></script>
    <script src="../../../../../../js/jobinterestsubmit.js"></script>

</body>
</html>
