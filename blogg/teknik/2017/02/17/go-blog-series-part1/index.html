<!DOCTYPE html>
<html lang="sv-se">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Callista Enterprise - seniora IT-arkitekter och systemutvecklare inom Java, öppen källkod, agil utveckling och systemintegration">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no"/>

    <link rel="icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="shortcut icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../../../../../../images/icons/callista_favicon_160x160.png">

    <title>Go Microservices blog series, part 1. | Callista</title>

    <link rel="stylesheet" href="../../../../../../css/style.css%3Fv=1.css">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for callistaenterprise.se" href="../../../../../../feed.xml" />

    <!--[if lte IE 8]>
    <style>* { display: none !important; }</style>
    <meta http-equiv="refresh" content="0; url=/oldie/"/>
    <![endif]-->

    <script type="text/javascript" src="https://use.typekit.net/kig5egm.js"></script>
    <script type="text/javascript">
        try {
            Typekit.load({ async: true });
        } catch (e) {
        }
    </script>

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
     fbq('init', '804675599711872');
     fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1" src="https://www.facebook.com/tr?id=804675599711872&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->

</head>
<body>

    <header class="ce-header" data-scroll="0">
    <nav>
        <img alt="menubg" class="ce-menu-icon" style="z-index:3; top: 0px; width: 50px; height: 100%;" src="../../../../../../images/icons/menu_background.png">
        <a class="ce-logotype" href="../../../../../../index.html" style="z-index: 2;">
            <img alt="Callista" style="max-width: 100%; height: auto;" src="../../../../../../images/logotype/callista_small2.svg">
        </a>
        <table>
            <tr>
                <td>
            <ul id="menu-primary" class="ce-menu-primary">
                
                    
                            <li><a href="../../../../../../om/index.html">Om oss</a></li>
                    
                
                    
                            <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                    
                
                    
                            <li><a href="../../../../../../event.html">Event</a></li>
                    
                
                    
                        
                            <li><a class="ce-active" href="../../../../../../blogg.html">Blogg</a></li>
                        
                    
                
                    
                            <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                    
                
            </ul>
                </td>

                <td>
            <ul class="ce-menu-secondary">
                
                <li><a href="../../../../../../english/index.html">English</a></li>
                
            </ul>
                </td>
            </tr>
        </table>
            <a id="menu" class="ce-menu-icon" href="../go-blog-series-part1.html#" style="z-index: 4;">
                <img alt="Visa meny" src="../../../../../../images/icons/menu.png">
            </a>
            <a class="ce-search-icon" href="../go-blog-series-part1.html#">
                <img alt="Sök" src="../../../../../../images/icons/search.png">
            </a>

        </table>
    </nav>
</header>


    <div class="ce-main">
        <section class="ce-start lazyImg">
    <article>
        <h1>Blogg</h1>
        <p class="ce-ingress">
            Här finns tekniska artiklar, presentationer och nyheter om arkitektur och systemutveckling. Håll dig uppdaterad, följ oss på <a class="ce-active" href="http://twitter.com/callistaent">Twitter</a>
        </p>
    </article>
</section>

<section class="ce-section">
    <div class="ce-content">
        
        

        
        

        <article class="ce-blog">
            <header>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <img alt="Callista medarbetare Erik Lupander" src="../../../../../../assets/medarbetare/eriklupander_mini.png">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <h2>
        <a href="../go-blog-series-part1.html">Go Microservices blog series, part 1.</a>
        
        
    </h2>
    <h3>
        <time datetime="2017-02-17T00:00:00+00:00">
            17 February 2017
        </time>
        //
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        
        
        <a href="../../../../../../om/medarbetare/eriklupander/index.html">Erik Lupander</a>
        

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </h3>
    
</header>




<p>In this blog series we’ll build Microservices using the <a href="https://golang.org/">Go</a> programming language and piece by piece add the necessary integrations to make them run nicely on <a href="https://www.docker.com/products/docker-swarm">Docker in swarm mode</a> within a <a href="https://cloud.spring.io/spring-cloud-netflix/">Spring Cloud / Netflix OSS</a> landscape.</p>

<p>If you’re unsure what a microservice is, I suggest reading Martin Fowler’s <a href="https://martinfowler.com/articles/microservices.html">article</a> about them. For more about the operations model for microservices, <a href="../../../../2015/03/25/an-operations-model-for-microservices/index.html">this blog post</a> from my colleague <a href="../../../../../../om/medarbetare/magnuslarsson/index.html">Magnus</a> explains the key concepts really well.</p>

<p>This blog series won’t be a beginner’s guide to coding in Go, though we will nevertheless write some code as we progress through the series and I’ll explain some key Go concepts along the way. We’ll be looking at a lot of code especially during the first parts where we’ll cover basic functionality, unit testing and other core topics.</p>

<p>Part one will be an introduction to key concepts and the rationale for exploring the possibilities with Go-based microservices.</p>

<p><em>Note: When referring to “Docker Swarm” in this blog series, I am referring to running Docker 1.12 or later in <a href="https://docs.docker.com/engine/swarm/">swarm mode</a>. “<a href="https://docs.docker.com/swarm/">Docker Swarm</a>” as a standalone concept was discontinued with the release of Docker 1.12.</em></p>

<h2 id="parts">Parts</h2>
<ul>
  <li>Part 1: Introduction and rationale for Go microservices (this part)</li>
  <li><a href="../../21/go-blog-series-part2.html">Part 2: Building our first Go microservice</a></li>
  <li><a href="../../27/go-blog-series-part3.html">Part 3: Embedding a data store and serving JSON</a></li>
  <li><a href="../../../03/03/go-blog-series-part4.html">Part 4: Unit testing HTTP services with GoConvey</a></li>
  <li><a href="../../../03/09/go-blog-series-part5.html">Part 5: Deploying on Docker Swarm</a></li>
  <li><a href="../../../03/22/go-blog-series-part6.html">Part 6: Adding Health checks</a></li>
  <li><a href="../../../04/24/go-blog-series-part7.html">Part 7: Service Discovery &amp; Load-balancing</a></li>
  <li><a href="../../../05/15/go-blog-series-part8.html">Part 8: Centralized configuration using Spring Cloud config and Viper</a></li>
  <li><a href="../../../06/08/go-blog-series-part9.html">Part 9: Messaging with AMQP</a></li>
  <li><a href="../../../08/02/go-blog-series-part10.html">Part 10: Logging to a LaaS with Logrus and Docker’s log drivers</a></li>
  <li><a href="../../../09/11/go-blog-series-part11.html">Part 11: Circuit Breakers and resilience with Netflix Hystrix</a></li>
  <li><a href="../../../10/25/go-blog-series-part12/index.html">Part 12: Distributed tracing with Zipkin</a></li>
  <li><a href="../../../../2018/02/14/go-blog-series-part13.html">Part 13: Distributed persistence with CockroachDB and GORM</a></li>
  <li><a href="../../../../2018/05/07/go-blog-series-part14/index.html">Part 14: GraphQL with Go</a></li>
  <li><a href="../../../../2018/09/12/go-blog-series-part15/index.html">Part 15: Monitoring with Prometheus and Grafana</a></li>
  <li><a href="../../../../2019/07/29/go-blog-series-part16/index.html">Part 16: It’s 2019, time for a rewrite!</a></li>
  <li><em>More to come…</em></li>
</ul>

<h2 id="landscape-overview">Landscape overview</h2>
<p>The image below provides an overall view of the system landscape we’ll be building throughout this blog series. However, we’ll start by writing our first Go microservice from scratch and then as we progress along the parts of the blog series, we’ll get closer and closer to what the image below represents.</p>

<p><img src="../../../../../../assets/blogg/goblog/part1-overview.png" alt="landscape overview" />
The legend is basically:</p>

<ul>
  <li>The dashed white box: A logical Docker Swarm cluster, running on one or more nodes.</li>
  <li>Blue boxes: Supporting service from the Spring Cloud / Netflix OSS stack or some other service such as Zipkin.</li>
  <li>Sand-colored / white box: An actual microservice.</li>
</ul>

<p>It’s more or less the same landscape used in <a href="../../../../2015/05/20/blog-series-building-microservices.html">Magnus Larssons microservices blog series</a>, with the main difference being that the actual microservices are implemented in Go instead of Java. The <em>quotes-service</em> is the exception as it provides us with a JVM-based microservice we can use for comparison as well as a testbed for seamless integration with our Go-based services.</p>

<h2 id="the-rationale---runtime-footprint">The rationale - runtime footprint</h2>
<p>Why would we want to write microservices in Go, one might ask? Besides being a quite fun and productive language to work with, the main rationale for building microservices in Go is the tiny memory footprint Go programs comes with. Let’s take a look at the screenshot below where we are running several Go microservices as well as a Microservice based on <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> and Spring Cloud infrastructure on Docker Swarm:</p>

<p><img src="../../../../../../assets/blogg/goblog/part-1-stats.png" alt="Memory footprint" /></p>

<p>The <em>quotes-service</em> is the Sprint Boot one while the <em>compservice</em> and <em>accountservice</em> ones are Go-based. Both are basically HTTP servers with a lot of libraries deployed to handle integration with the Spring Cloud infrastructure.</p>

<p>Does this really matter in 2017? Arn’t we deploying on servers these days with many gigabytes of RAM that easily fits an impressive number of let’s say Java-based applications in memory? That’s true - but a large enterprise isn’t running tens of services - they could very well be running hundreds or even thousands of containerized (micro)services on a cloud provider. When running a huge amount of containers, being resource-efficient can save your company a lot of money over time.</p>

<p>Let’s take a look at Amazon EC2 pricing for general purpose on-demand instances (per 2017-02-15):</p>

<p><img src="../../../../../../assets/blogg/goblog/part1-amazon-ec2.png" alt="pricing" /></p>

<p>Comparing the various t2 instances, we see that for a given CPU core count, doubling the amount of RAM (for example: 4 to 8 GB from t2.medium to t2.large) also <em>doubles</em> the hourly rate. If you’re not CPU-constrained, being able to fit twice the amount of microservices into a given instance could theoretically halve your cloud provider bill. As we’ll see in later blog posts, even when under load our Go services use a <em>lot</em> less RAM than an idling Spring Boot-based one.</p>

<h2 id="non-functional-requirements-on-a-microservice">Non-functional requirements on a microservice</h2>
<p>This blog series is not just about how to build a microservice using Go - it’s just as much about having it behave nicely within a Spring Cloud environment and conform to the qualities a production-ready microservice landscape will require of it.</p>

<p>Consider (in no particular order):</p>

<ul>
  <li>Centralized configuration</li>
  <li>Service Discovery</li>
  <li>Logging</li>
  <li>Distributed Tracing</li>
  <li>Circuit Breaking</li>
  <li>Load balancing</li>
  <li>Edge</li>
  <li>Monitoring</li>
  <li>Security</li>
</ul>

<p>All of these are things I think you must take into account when deciding to go for a microservice architecture regardless if you’re going to code it in Go, Java, js, python, C# or whatever’s your liking. In this blog series I’ll try to cover all these topics from the Go perspective.</p>

<p>Another perspective are things <em>within</em> your actual microservice implementation. Regardless of where you’re coming from, you probably have worked with libraries that provides things such as:</p>

<ul>
  <li>HTTP / RPC / REST / SOAP / Whatever APIs</li>
  <li>Persistence APIs (DB clients, JDBC, O/R mappers)</li>
  <li>Messaging APIs (MQTT, AMQP, JMS)</li>
  <li>Testability (Unit / Integration / System / Acceptance)</li>
  <li>Build tools / CI / CD</li>
  <li>More…</li>
</ul>

<p>I won’t touch on all of these topics. If I would, I could just as well write a book instead of a blog series. I’ll cover at least a few of them.</p>

<h2 id="running-on-docker-swarm">Running on Docker Swarm</h2>

<p>A basic premise of the system landscape of this blog series is that Docker Swarm will be our runtime environment which means all services - be it the supporting ones (config server, edge etc.) or our actual microservice implementations will be deployed as <a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/">Docker Swarm services</a>. When we’re at the end of the blog series, the following Docker command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker service ls
</code></pre></div></div>

<p>Will show us a list of all services deployed in the sample landscape, each having one replica.</p>

<p><img src="../../../../../../assets/blogg/goblog/part1-swarm-services.png" alt="Service list" /></p>

<p>Again - please note that the services listed above includes a lot more services than we’ll have when we’ll setup up our Swarm cluster in <a href="../../../03/09/go-blog-series-part5.html">Part 5</a> of the blog series.</p>

<h2 id="performance">Performance</h2>

<p>Ok - so Go microservices has a small memory footprint - but will they perform? Benchmarking programming languages against each other in a meaningful way can be quite difficult. That said, if one looks at a site such as <a href="https://benchmarksgame.alioth.debian.org/u64q/go.html">Benchmarkgame</a> where people can submit implementations of explicit algorithms for a variety of languages and have them benchmarked against each other, Go is typically slightly faster than Java 8 with a few notable exceptions. Go in it’s turn, is typically almost on par with C++ or - in the case of a few benchmarks - a lot slower. That said - Go typically performs just fine for typical “microservice” workloads - serving HTTP/RPC, serializing/deserializing data structures, handling network IO etc.</p>

<p>Another rather important attribute of Go is that it is a garbage collected language. After the major rewrite of the Garbage Collector for Go 1.5 GC pauses should typically be a few milliseconds at most. If you’re coming from the world of JVMs (as I do myself), the Go garbage collector is perhaps not as mature but it does seem to be very reliable after changes introduced somewhere after Go 1.2 or so. It’s also is a miracle of non-configurability - there is exactly <em>one</em> knob (<a href="https://dave.cheney.net/2015/11/29/a-whirlwind-tour-of-gos-runtime-environment-variables">GOGC</a>) you can tweak regarding GC behaviour in Go which controls the total size of the heap relative to the size of reachable objects.</p>

<p>However - keeping track of performance impact as we’ll build our first microservice and then add things like circuit breakers, tracing, logging etc. to it can be very interesting so we’ll use a <a href="http://gatling.io/">Gatling</a> test in upcoming blog posts to see how performance develops as we add more and more functionality to the microservices.</p>

<h2 id="boot-time">Boot time</h2>
<p>Another nice characteristic of your typical Go application is that it starts <em>really</em> fast. A simple HTTP server with a bit of routing, JSON serialization etc. typically starts in a few hundred milliseconds at the most. When we start running our Go microservices within Docker containers, we’ll see them healthy and ready to serve in a few seconds at most, while our reference Spring Boot-based microservice typically needs at least 10 seconds until ready. Perhaps not the singularly most important characteristic, although it can certainly be beneficial when your environment needs to handle unexpected surges in traffic volumes by quickly scaling up.</p>

<h2 id="statically-linked-binaries">Statically linked binaries</h2>

<p>Another big upside with Go-based microservices in Docker containers is that we get a <a href="https://en.wikipedia.org/wiki/Static_library">statically linked</a> binary with all dependencies in a single executable binary. While the file isn’t very compact (typically 10-20 mb for a real microservice), the big upside is that we get really simple Dockerfiles and that we can use very bare base Docker images. I’m using a base image called <a href="https://hub.docker.com/r/iron/base/">iron/base</a> that weighs in at just ~6 mb.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM iron/base

EXPOSE 6868
ADD eventservice-linux-amd64 /
ENTRYPOINT ["./eventservice-linux-amd64", "-profile=test"]
</code></pre></div></div>

<p>In other words - no JVM or other runtime component is required except for the standard C library (libc) which is included in the base image.</p>

<p>We’ll go into more detail about how to build our binaries and that <em>-profile=test</em> thing in later blog posts.</p>

<h2 id="summary">Summary</h2>

<p>In this blog post, we introduced some of the key reasons for building microservices using Go such as small memory footprint, good performance and the convenience of statically linked binaries.</p>

<p>In the <a href="../../21/go-blog-series-part2.html">next part</a>, we’ll build our first Go-based microservice.</p>









            <div class="ce-blog-thanks">
              Tack för att du läser Callistas blogg. <br>
              Hjälp oss att nå ut med information genom att dela nyheter och artiklar i ditt nätverk.<br>
            </div>

            


    
<div class="ce-blog-share">
    <a class="ce-blog-share-element social-twitter" href="https://twitter.com/intent/tweet?text=Go Blog Series Part1&url=https://callistaenterprise.se/blogg/teknik/2017/02/17/go-blog-series-part1/&via=callistaent&hashtags=" target="_blank" title="Share this post on Twitter"></a>
    <a class="ce-blog-share-element social-facebook" href="https://www.facebook.com/sharer/sharer.php?t=Go Blog Series Part1&u=https://callistaenterprise.se/blogg/teknik/2017/02/17/go-blog-series-part1/" target="_blank" title="Share this post on Facebook"></a>
    <a class="ce-blog-share-element social-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Go Blog Series Part1&url=https://callistaenterprise.se/blogg/teknik/2017/02/17/go-blog-series-part1/&source=http%3a%2f%2fzhangwenli.com" target="_blank" title="Share this post on LinkedIn"></a>
</div>
    
        </article>
    </div>
</section>


<section class="ce-section">
    <heading>
        <h1>Kommentarer</h1>
    </heading>
    <div class="ce-content">
        <div id="disqus_thread"></div>
        <script src="../../../../../../js/disqus.js"></script>
    </div>
</section>


    </div>

    <footer class="ce-footer">
    <div class="ce-wrapper">
        <nav class="ce-menu-footer-primary">
            <h2><a href="../../../../../../index.html">Callista</a></h2>
            <ul>
                
                <li><a href="../../../../../../om/index.html">Om oss</a></li>
                
                <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                
                <li><a href="../../../../../../event.html">Event</a></li>
                
                <li><a href="../../../../../../blogg.html">Blogg</a></li>
                
                <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                

                
                    
                        <li><a href="../../../../../../english/index.html">English</a></li>
                    
                
            </ul>
        </nav>
        <div class="ce-addresses">
            <div class="ce-address">
                <h2>Stockholm</h2>
                <address>
                    Drottninggatan 55<br>
                    111 21 Stockholm<br>
                    Tel:
                    <a href="tel:+468212142">
                        +46 8 21 21 42
                    </a>
                </address>
            </div>
            <div class="ce-address">
                <h2>Göteborg</h2>
                <address>
                    Fabriksgatan 13<br>
                    412 50 Göteborg<br>
                    Tel:
                    <a href="tel:+4631201918">
                        +46 31 20 19 18
                    </a>
                </address>
            </div>
        </div>
        <div class="ce-social">
            <h2>Följ oss</h2>
            <ul>
                <li>
                    <a href="http://twitter.com/callistaent">
                        <img alt="Twitters logotype" src="../../../../../../images/icons/twitter.png">
                        <span>@callistaent</span>
                    </a>
                </li>
            </ul>
        </div>
        <small>&copy; 2021 Callista Enterprise AB</small>
        <hr style="margin: 1em 0 2em 0">
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-raddabarnen" href="http://www.raddabarnen.se/foretag">
                <img alt="Callista är Rädda Barnens företagsvän 2021" src="../../../../../../images/logotype/rb_vanforetag_2021_large-sv.png">
            </a>
          </div>
        </div>
        <br>
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-di-gasell" href="http://www.di.se/gasell/">
              <img alt="Callista utsett till DI Gasell tre år i rad" src="../../../../../../images/logotype/di_gasell_180x194.png">
            </a>
          </div>
        </div>
    </div>
</footer>


    <script src="../../../../../../js/lib/jquery.min.js"></script>
    <script src="../../../../../../js/lib/owl.carousel.min.js"></script>
    <script src="../../../../../../js/lib/prismjs.min.js"></script>
    <script src="../../../../../../js/app.js"></script>
    <script src="../../../../../../js/analytics.js"></script>
    <script src="../../../../../../js/jobinterestsubmit.js"></script>

</body>
</html>
