<!DOCTYPE html>
<html lang="sv-se">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Callista Enterprise - seniora IT-arkitekter och systemutvecklare inom Java, öppen källkod, agil utveckling och systemintegration">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no"/>

    <link rel="icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="shortcut icon" href="../../../../../../images/icons/callista_favicon.svg" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../../../../../../images/icons/callista_favicon_160x160.png">

    <title>Dynamic Lists with Asynchronous Data Loading in SwiftUI | Callista</title>

    <link rel="stylesheet" href="../../../../../../css/style.css%3Fv=1.css">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for callistaenterprise.se" href="../../../../../../feed.xml" />

    <!--[if lte IE 8]>
    <style>* { display: none !important; }</style>
    <meta http-equiv="refresh" content="0; url=/oldie/"/>
    <![endif]-->

    <script type="text/javascript" src="https://use.typekit.net/kig5egm.js"></script>
    <script type="text/javascript">
        try {
            Typekit.load({ async: true });
        } catch (e) {
        }
    </script>

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
     fbq('init', '804675599711872');
     fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1" src="https://www.facebook.com/tr?id=804675599711872&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->

</head>
<body>

    <header class="ce-header" data-scroll="0">
    <nav>
        <img alt="menubg" class="ce-menu-icon" style="z-index:3; top: 0px; width: 50px; height: 100%;" src="../../../../../../images/icons/menu_background.png">
        <a class="ce-logotype" href="../../../../../../index.html" style="z-index: 2;">
            <img alt="Callista" style="max-width: 100%; height: auto;" src="../../../../../../images/logotype/callista_small2.svg">
        </a>
        <table>
            <tr>
                <td>
            <ul id="menu-primary" class="ce-menu-primary">
                
                    
                            <li><a href="../../../../../../om/index.html">Om oss</a></li>
                    
                
                    
                            <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                    
                
                    
                            <li><a href="../../../../../../event.html">Event</a></li>
                    
                
                    
                        
                            <li><a class="ce-active" href="../../../../../../blogg.html">Blogg</a></li>
                        
                    
                
                    
                            <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                    
                
            </ul>
                </td>

                <td>
            <ul class="ce-menu-secondary">
                
                <li><a href="../../../../../../english/index.html">English</a></li>
                
            </ul>
                </td>
            </tr>
        </table>
            <a id="menu" class="ce-menu-icon" href="index.html#" style="z-index: 4;">
                <img alt="Visa meny" src="../../../../../../images/icons/menu.png">
            </a>
            <a class="ce-search-icon" href="index.html#">
                <img alt="Sök" src="../../../../../../images/icons/search.png">
            </a>

        </table>
    </nav>
</header>


    <div class="ce-main">
        <section class="ce-start lazyImg">
    <article>
        <h1>Blogg</h1>
        <p class="ce-ingress">
            Här finns tekniska artiklar, presentationer och nyheter om arkitektur och systemutveckling. Håll dig uppdaterad, följ oss på <a class="ce-active" href="http://twitter.com/callistaent">Twitter</a>
        </p>
    </article>
</section>

<section class="ce-section">
    <div class="ce-content">
        
        

        
        

        <article class="ce-blog">
            <header>
    
    
    
    
    
    
    
    
    
    
    
    
    
    <img alt="Callista medarbetare Anders Forssell" src="../../../../../../assets/medarbetare/andersforssell_mini.png">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <h2>
        <a href="index.html">Dynamic Lists with Asynchronous Data Loading in SwiftUI</a>
        
        
    </h2>
    <h3>
        <time datetime="2020-04-20T00:00:00+00:00">
            20 April 2020
        </time>
        //
        
        
        
        
        
        
        
        
        
        
        
        
        

        
        
        <a href="../../../../../../om/medarbetare/andersforssell.html">Anders Forssell</a>
        

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </h3>
    
</header>




<p>SwiftUI is an exciting new way to create UI on Apples platforms. But it is still a young technology and it can sometimes be hard to find information needed to support the implementation of more advanced use cases.</p>

<p>In porting an app to SwiftUI, I’ve been struggling a bit with the <code class="language-plaintext highlighter-rouge">List</code> view. <code class="language-plaintext highlighter-rouge">List</code> is a very powerful container view that makes it incredibly easy to create table style components.</p>

<p>But if you want to up your game by adding more features, such as dynamically loading more rows as the the user scrolls, or fetching data asynchronously, it gets a little trickier.  That’s when you would like to know more about how <code class="language-plaintext highlighter-rouge">List</code> works its magic behind the scenes - but information is scarce about things like cell reuse, redrawing, handling animations, etc.</p>

<p>After some experimentation (and trial and error), I managed to come up with a list that met some more advanced requirements. I also created a few helper components that I would like to share - in case someone else is looking for similar solutions.</p>

<h2 id="list-requirements">List Requirements</h2>
<p>The requirements for my list are as follows.</p>

<ol>
  <li>The list should grow dynamically and batch-wise as the user scrolls</li>
  <li>The data on each row is fetched from a (possibly) slow data source - must be possible to be performed asynchronously in the background</li>
  <li>Some row data should be animated in two different situations: a) when data has been fetched and b) whenever a row becomes visible</li>
  <li>Possibility to reset the list and reload data</li>
  <li>Smooth scrolling throughout</li>
</ol>

<p>Below is a simple video that shows an example of how the list should work.</p>

<p><a href="../../../../../../assets/blogg/swiftui/RPReplay_Final1587392731.mov" title=" "><img src="../../../../../../assets/blogg/swiftui/RPReplay_Final1587392731.png" alt="Video" /></a></p>

<h1 id="the-solution">The Solution</h1>

<p>I will now walk you through essential parts of the solution. The complete code is shown at the end of this article and can also be downloaded here: <a href="https://github.com/callistaenterprise/SwiftUIListExample">https://github.com/callistaenterprise/SwiftUIListExample</a></p>

<p>We start with some of the plumbing which consists of a few protocols and generic components which may be used as a foundation for any list of this type.</p>

<h2 id="data-model">Data Model</h2>

<p>First off is the data model and we begin with the <code class="language-plaintext highlighter-rouge">ListDataItem</code> protocol which should be adopted by the component representing  row data. It must have an <code class="language-plaintext highlighter-rouge">Int</code> index which is used to determine when more data needs to be loaded, more on this later.</p>

<p>It also contains a function - <code class="language-plaintext highlighter-rouge">fetchData</code> - that retrieves data for the row in a second - possibly slower - step.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// The data items of the list. Must contain index (row number) as a stored property</span>
<span class="kd">protocol</span> <span class="kt">ListDataItem</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>

    <span class="c1">/// Fetch additional data of the item, possibly asynchronously</span>
    <span class="kd">func</span> <span class="nf">fetchData</span><span class="p">()</span>

    <span class="c1">/// Has the data been fetched?</span>
    <span class="k">var</span> <span class="nv">dataIsFetched</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Next out is the <code class="language-plaintext highlighter-rouge">ListDataProvider</code> - a generic class that maintains the actual list of data items, stored in a published property that is used directly by the <code class="language-plaintext highlighter-rouge">List</code> view.</p>

<p>The method <code class="language-plaintext highlighter-rouge">fetchMoreItemsIfNeeded</code> is called by the view when a new row is presented. It will check if more items need to be fetched and will also initiate loading of additional data for each row.</p>

<p>The properties <code class="language-plaintext highlighter-rouge">itemBatchCount</code> and <code class="language-plaintext highlighter-rouge">prefetchMargin</code> can be used to fine tune the list behaviour.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Generic data provider for the list</span>
<span class="kd">class</span> <span class="kt">ListDataProvider</span><span class="o">&lt;</span><span class="kt">Item</span><span class="p">:</span> <span class="kt">ListDataItem</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="c1">/// - Parameters:</span>
    <span class="c1">///   - itemBatchCount: Number of items to fetch in each batch. It is recommended to be greater than number of rows displayed.</span>
    <span class="c1">///   - prefetchMargin: How far in advance should the next batch be fetched? Greater number means more eager.</span>
    <span class="c1">///                     Sholuld be less than temBatchSize.</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">itemBatchCount</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="nv">prefetchMargin</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">itemBatchSize</span> <span class="o">=</span> <span class="n">itemBatchCount</span>
        <span class="k">self</span><span class="o">.</span><span class="n">prefetchMargin</span> <span class="o">=</span> <span class="n">prefetchMargin</span>
        <span class="nf">reset</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="k">let</span> <span class="nv">itemBatchSize</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">prefetchMargin</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">listID</span><span class="p">:</span> <span class="kt">UUID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>

    <span class="kd">func</span> <span class="nf">reset</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">listID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
        <span class="nf">fetchMoreItemsIfNeeded</span><span class="p">(</span><span class="nv">currentIndex</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">list</span><span class="p">:</span> <span class="p">[</span><span class="kt">Item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">/// Extend the list if we are close to the end, based on the specified index</span>
    <span class="kd">func</span> <span class="nf">fetchMoreItemsIfNeeded</span><span class="p">(</span><span class="nv">currentIndex</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">currentIndex</span> <span class="o">&gt;=</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="n">prefetchMargin</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">startIndex</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span>
        <span class="k">for</span> <span class="n">currentIndex</span> <span class="k">in</span> <span class="n">startIndex</span> <span class="o">..&lt;</span> <span class="nf">max</span><span class="p">(</span><span class="n">startIndex</span> <span class="o">+</span> <span class="n">itemBatchSize</span><span class="p">,</span> <span class="n">currentIndex</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">list</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Item</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="n">currentIndex</span><span class="p">))</span>
            <span class="n">list</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span><span class="o">.</span><span class="nf">fetchData</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="views">Views</h2>

<p>Now we come to the second part of the plumbing - which concerns the views. The structure is similar  to that of the data model components. There is one protocol - <code class="language-plaintext highlighter-rouge">DynamicListRow</code> - that the row view should adopt. And a generic struct - <code class="language-plaintext highlighter-rouge">DynamicList</code> - which is used as the actual list view.</p>

<p><code class="language-plaintext highlighter-rouge">DynamicList</code> may need some further explanation. The generic parameter <code class="language-plaintext highlighter-rouge">Row</code> is a custom view that is used to visualize the row in any fashion you would like. The list gets it data  from <code class="language-plaintext highlighter-rouge">listProvider</code>, a property of the type <code class="language-plaintext highlighter-rouge">ListDataProvider</code> that we defined above.</p>

<p>The <code class="language-plaintext highlighter-rouge">onAppear</code> modifier on the row view is there to ensure that more items are fetched as needed by calling <code class="language-plaintext highlighter-rouge">fetchMoreItemsIfNeeded</code> every time a row becomes visible.</p>

<p>There is also an <code class="language-plaintext highlighter-rouge">id</code> modifier on the list view itself. What is the purpose of that, you may ask? The <code class="language-plaintext highlighter-rouge">listID</code> property provides a unique id that remains the same until the list is reset, in which case a new unique id is generated. This ensures that list is completely redrawn when it is reset. Leaving it out could sometimes cause the list to not fetch enough data when reset, especially for small batch sizes.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// The view for the list row</span>
<span class="kd">protocol</span> <span class="kt">DynamicListRow</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">Item</span><span class="p">:</span> <span class="kt">ListDataItem</span>
    <span class="k">var</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">Item</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">Item</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">/// The view for the dynamic list</span>
<span class="kd">struct</span> <span class="kt">DynamicList</span><span class="o">&lt;</span><span class="kt">Row</span><span class="p">:</span> <span class="kt">DynamicListRow</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">listProvider</span><span class="p">:</span> <span class="kt">ListDataProvider</span><span class="o">&lt;</span><span class="kt">Row</span><span class="o">.</span><span class="kt">Item</span><span class="o">&gt;</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">return</span>
            <span class="kt">List</span><span class="p">(</span><span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">listProvider</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">index</span> <span class="k">in</span>
                <span class="kt">Row</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                    <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="nf">fetchMoreItemsIfNeeded</span><span class="p">(</span><span class="nv">currentIndex</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">id</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="n">listID</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>That’s all for the plumbing, let’s move on to an example of how to use this to create our list.</p>

<h1 id="list-example">List Example</h1>

<p>Here is an example of how to implement a list using the components we’ve defined above.</p>

<p>To be able to demonstrate how it works with asynchronous data loading we start with a very simple datastore called <code class="language-plaintext highlighter-rouge">SlowDataStore</code>. It offers a static function that will give us a random amount between 0 and 1 as a publisher which takes between 0.5 and 2.0 seconds to deliver the value - implemented as a <code class="language-plaintext highlighter-rouge">usleep</code> on a background queue.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">SlowDataStore</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">getAmount</span><span class="p">(</span><span class="n">forIndex</span> <span class="nv">_</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">Just</span><span class="p">(</span><span class="kt">Double</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">0</span> <span class="o">..&lt;</span> <span class="mi">1</span><span class="p">))</span>
            <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">(</span><span class="nv">qos</span><span class="p">:</span> <span class="o">.</span><span class="n">background</span><span class="p">))</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">val</span> <span class="k">in</span> <span class="nf">usleep</span><span class="p">(</span><span class="kt">UInt32</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">500_000</span> <span class="o">..&lt;</span> <span class="mi">2_000_000</span><span class="p">));</span> <span class="k">return</span> <span class="n">val</span> <span class="p">}</span>
            <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next, we create our custom data item in the class <code class="language-plaintext highlighter-rouge">MyDataItem</code> which conforms to the <code class="language-plaintext highlighter-rouge">ListDataItem</code> protocol. It is a quite straightforward implementation of the protocol requirements. Note that <code class="language-plaintext highlighter-rouge">dataPublisher</code> needs to be a stored property in order to keep the publisher from <code class="language-plaintext highlighter-rouge">SlowDataStore</code> alive while waiting for the data to arrive.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">MyDataItem</span><span class="p">:</span> <span class="kt">ListDataItem</span><span class="p">,</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">dataIsFetched</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">amount</span> <span class="o">!=</span> <span class="kc">nil</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">label</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="s">"Line </span><span class="se">\(</span><span class="n">index</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">dataPublisher</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">fetchData</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">dataIsFetched</span> <span class="p">{</span>
            <span class="n">dataPublisher</span> <span class="o">=</span> <span class="kt">SlowDataStore</span><span class="o">.</span><span class="nf">getAmount</span><span class="p">(</span><span class="nv">forIndex</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
                <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">amount</span> <span class="k">in</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The final part of the list is our custom row view which conforms to the <code class="language-plaintext highlighter-rouge">DynamicListRow</code> protocol. The row contains a horizontal stack with three elements:</p>
<ul>
  <li>A text view displaying the line number</li>
  <li>A text view displaying “Loading…” if data is not yet available, otherwise displaying the amount.</li>
  <li>A custom graph bar view that displays the amount graphically. The implementation of <code class="language-plaintext highlighter-rouge">GraphBar</code> is given with the complete solution at the end.</li>
</ul>

<p>The animation is triggered by the two modifiers on the horizontal stack. The first one - <code class="language-plaintext highlighter-rouge">onReceive</code> - is used when data first arrives from the <code class="language-plaintext highlighter-rouge">SlowDataStore</code>. The second one - <code class="language-plaintext highlighter-rouge">onAppear</code> - is used when the row appears and data is already available.</p>

<blockquote>
  <p><strong>Note:</strong> The animation triggered by <code class="language-plaintext highlighter-rouge">onReceive</code> and <code class="language-plaintext highlighter-rouge">onAppear</code> needs to be mutually exclusive, otherwise the animation will not work correctly. That’s why we test the property <code class="language-plaintext highlighter-rouge">dataIsFetched</code>.</p>
</blockquote>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">MyListRow</span><span class="p">:</span> <span class="kt">DynamicListRow</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">MyDataItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>
    <span class="p">}</span>

    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">MyDataItem</span>
    <span class="kd">@State</span> <span class="k">var</span> <span class="nv">animatedAmount</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span>

    <span class="k">let</span> <span class="nv">graphAnimation</span> <span class="o">=</span> <span class="kt">Animation</span><span class="o">.</span><span class="nf">interpolatingSpring</span><span class="p">(</span><span class="nv">stiffness</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="nv">damping</span><span class="p">:</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">HStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">callout</span><span class="p">)</span>
            <span class="kt">Text</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">?</span> <span class="s">"Loading..."</span> <span class="p">:</span>
                <span class="kt">String</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"Amount: %.1f"</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span><span class="o">!</span><span class="p">))</span>
                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">callout</span><span class="p">)</span>
            <span class="kt">GraphBar</span><span class="p">(</span><span class="nv">amount</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="nv">animatedAmount</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="err">$</span><span class="n">animatedAmount</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="err">$</span><span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="n">amount</span> <span class="k">in</span>
            <span class="k">if</span> <span class="o">!</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">dataIsFetched</span> <span class="p">{</span>
                <span class="nf">withAnimation</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">graphAnimation</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">animatedAmount</span> <span class="o">=</span> <span class="n">amount</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">dataIsFetched</span> <span class="p">{</span>
                <span class="nf">withAnimation</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">graphAnimation</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">animatedAmount</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We now just need to wrap it all up in a container view as shown below.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">listProvider</span> <span class="o">=</span> <span class="kt">ListDataProvider</span><span class="o">&lt;</span><span class="kt">MyDataItem</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">itemBatchCount</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nv">prefetchMargin</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">DynamicList</span><span class="o">&lt;</span><span class="kt">MyListRow</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">listProvider</span><span class="p">:</span> <span class="n">listProvider</span><span class="p">)</span>

            <span class="kt">Button</span><span class="p">(</span><span class="s">"Reset"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="nf">reset</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="conclusion">Conclusion</h1>

<p>I hope this article contains some useful information that will help you build your own lists based on similar requirements. Please let me know what you think, and feel free to post any questions, comments or suggestions.</p>

<p>The complete code is given below. You can also download sample XCode-project here: <a href="https://github.com/callistaenterprise/SwiftUIListExample">https://github.com/callistaenterprise/SwiftUIListExample</a></p>

<h1 id="complete-source-code">Complete Source Code</h1>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//</span>
<span class="c1">//    DynamicListView.swift</span>
<span class="c1">//</span>
<span class="c1">//</span>

<span class="kd">import</span> <span class="kt">Combine</span>
<span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="c1">// MARK: - General Components</span>

<span class="c1">/// The data items of the list. Must contain index (row number) as a stored property.</span>
<span class="kd">protocol</span> <span class="kt">ListDataItem</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>

    <span class="c1">/// Fetch additional data of the item, possibly asynchronously.</span>
    <span class="kd">func</span> <span class="nf">fetchData</span><span class="p">()</span>

    <span class="c1">/// Has the data been fetched?</span>
    <span class="k">var</span> <span class="nv">dataIsFetched</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// Generic data provider for the list.</span>
<span class="kd">class</span> <span class="kt">ListDataProvider</span><span class="o">&lt;</span><span class="kt">Item</span><span class="p">:</span> <span class="kt">ListDataItem</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="c1">/// - Parameters:</span>
    <span class="c1">///   - itemBatchCount: Number of items to fetch in each batch. It is recommended to be greater than number of rows displayed.</span>
    <span class="c1">///   - prefetchMargin: How far in advance should the next batch be fetched? Greater number means more eager.</span>
    <span class="c1">///                     Sholuld be less than temBatchSize</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">itemBatchCount</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="nv">prefetchMargin</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">itemBatchSize</span> <span class="o">=</span> <span class="n">itemBatchCount</span>
        <span class="k">self</span><span class="o">.</span><span class="n">prefetchMargin</span> <span class="o">=</span> <span class="n">prefetchMargin</span>
        <span class="nf">reset</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="k">let</span> <span class="nv">itemBatchSize</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">prefetchMargin</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">listID</span><span class="p">:</span> <span class="kt">UUID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>

    <span class="kd">func</span> <span class="nf">reset</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">listID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
        <span class="nf">fetchMoreItemsIfNeeded</span><span class="p">(</span><span class="nv">currentIndex</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">list</span><span class="p">:</span> <span class="p">[</span><span class="kt">Item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">/// Extend the list if we are close to the end, based on the specified index</span>
    <span class="kd">func</span> <span class="nf">fetchMoreItemsIfNeeded</span><span class="p">(</span><span class="nv">currentIndex</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">currentIndex</span> <span class="o">&gt;=</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="n">prefetchMargin</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">startIndex</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span>
        <span class="k">for</span> <span class="n">currentIndex</span> <span class="k">in</span> <span class="n">startIndex</span> <span class="o">..&lt;</span> <span class="nf">max</span><span class="p">(</span><span class="n">startIndex</span> <span class="o">+</span> <span class="n">itemBatchSize</span><span class="p">,</span> <span class="n">currentIndex</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">list</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Item</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="n">currentIndex</span><span class="p">))</span>
            <span class="n">list</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">]</span><span class="o">.</span><span class="nf">fetchData</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// The view for the list row</span>
<span class="kd">protocol</span> <span class="kt">DynamicListRow</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">Item</span><span class="p">:</span> <span class="kt">ListDataItem</span>
    <span class="k">var</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">Item</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">Item</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">/// The view for the dynamic list</span>
<span class="kd">struct</span> <span class="kt">DynamicList</span><span class="o">&lt;</span><span class="kt">Row</span><span class="p">:</span> <span class="kt">DynamicListRow</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">listProvider</span><span class="p">:</span> <span class="kt">ListDataProvider</span><span class="o">&lt;</span><span class="kt">Row</span><span class="o">.</span><span class="kt">Item</span><span class="o">&gt;</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">return</span>
            <span class="kt">List</span><span class="p">(</span><span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">listProvider</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">index</span> <span class="k">in</span>
                    <span class="kt">Row</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                        <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span>
                            <span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="nf">fetchMoreItemsIfNeeded</span><span class="p">(</span><span class="nv">currentIndex</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
                        <span class="p">}</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="nf">id</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="n">listID</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Dynamic List Example</span>

<span class="kd">struct</span> <span class="kt">SlowDataStore</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">getAmount</span><span class="p">(</span><span class="n">forIndex</span> <span class="nv">_</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kt">Just</span><span class="p">(</span><span class="kt">Double</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">0</span> <span class="o">..&lt;</span> <span class="mi">1</span><span class="p">))</span>
            <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">(</span><span class="nv">qos</span><span class="p">:</span> <span class="o">.</span><span class="n">background</span><span class="p">))</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">val</span> <span class="k">in</span> <span class="nf">usleep</span><span class="p">(</span><span class="kt">UInt32</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">500_000</span> <span class="o">..&lt;</span> <span class="mi">2_000_000</span><span class="p">));</span> <span class="k">return</span> <span class="n">val</span> <span class="p">}</span>
            <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="kt">MyDataItem</span><span class="p">:</span> <span class="kt">ListDataItem</span><span class="p">,</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">dataIsFetched</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">amount</span> <span class="o">!=</span> <span class="kc">nil</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">label</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="s">"Line </span><span class="se">\(</span><span class="n">index</span><span class="se">)</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">dataPublisher</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">fetchData</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">dataIsFetched</span> <span class="p">{</span>
            <span class="n">dataPublisher</span> <span class="o">=</span> <span class="kt">SlowDataStore</span><span class="o">.</span><span class="nf">getAmount</span><span class="p">(</span><span class="nv">forIndex</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
                <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">amount</span> <span class="k">in</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
                <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">MyListRow</span><span class="p">:</span> <span class="kt">DynamicListRow</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">item</span><span class="p">:</span> <span class="kt">MyDataItem</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>
    <span class="p">}</span>

    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">MyDataItem</span>
    <span class="kd">@State</span> <span class="k">var</span> <span class="nv">animatedAmount</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span>

    <span class="k">let</span> <span class="nv">graphAnimation</span> <span class="o">=</span> <span class="kt">Animation</span><span class="o">.</span><span class="nf">interpolatingSpring</span><span class="p">(</span><span class="nv">stiffness</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="nv">damping</span><span class="p">:</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">HStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">callout</span><span class="p">)</span>
            <span class="kt">Text</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">?</span> <span class="s">"Loading..."</span> <span class="p">:</span>
                <span class="kt">String</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"Amount: %.1f"</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span><span class="o">!</span><span class="p">))</span>
                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">callout</span><span class="p">)</span>
            <span class="kt">GraphBar</span><span class="p">(</span><span class="nv">amount</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="nv">animatedAmount</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="err">$</span><span class="n">animatedAmount</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="err">$</span><span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="n">amount</span> <span class="k">in</span>
            <span class="k">if</span> <span class="o">!</span><span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">dataIsFetched</span> <span class="p">{</span>
                <span class="nf">withAnimation</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">graphAnimation</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">animatedAmount</span> <span class="o">=</span> <span class="n">amount</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">dataIsFetched</span> <span class="p">{</span>
                <span class="nf">withAnimation</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">graphAnimation</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">animatedAmount</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">amount</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">GraphBar</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span>
    <span class="kd">@Binding</span> <span class="k">var</span> <span class="nv">animatedAmount</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">theAmount</span> <span class="o">=</span> <span class="n">amount</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">Color</span><span class="o">.</span><span class="n">gray</span> <span class="p">}</span>
        <span class="k">switch</span> <span class="n">theAmount</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mf">0.0</span> <span class="o">..&lt;</span> <span class="mf">0.3</span><span class="p">:</span> <span class="k">return</span> <span class="kt">Color</span><span class="o">.</span><span class="n">red</span>
        <span class="k">case</span> <span class="mf">0.3</span> <span class="o">..&lt;</span> <span class="mf">0.7</span><span class="p">:</span> <span class="k">return</span> <span class="kt">Color</span><span class="o">.</span><span class="n">yellow</span>
        <span class="k">case</span> <span class="mf">0.7</span> <span class="o">...</span> <span class="mf">1.0</span><span class="p">:</span> <span class="k">return</span> <span class="kt">Color</span><span class="o">.</span><span class="n">green</span>
        <span class="k">default</span><span class="p">:</span> <span class="k">return</span> <span class="kt">Color</span><span class="o">.</span><span class="n">gray</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometry</span> <span class="k">in</span>
            <span class="kt">ZStack</span> <span class="p">{</span>
                <span class="kt">Capsule</span><span class="p">()</span>
                    <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">maxWidth</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">animatedAmount</span> <span class="p">??</span> <span class="mi">0</span><span class="p">)),</span> <span class="nv">maxHeight</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">listProvider</span> <span class="o">=</span> <span class="kt">ListDataProvider</span><span class="o">&lt;</span><span class="kt">MyDataItem</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">itemBatchCount</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nv">prefetchMargin</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">DynamicList</span><span class="o">&lt;</span><span class="kt">MyListRow</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">listProvider</span><span class="p">:</span> <span class="n">listProvider</span><span class="p">)</span>

            <span class="kt">Button</span><span class="p">(</span><span class="s">"Reset"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">listProvider</span><span class="o">.</span><span class="nf">reset</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">DynamicList_Previews</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ContentView</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">environment</span><span class="p">(\</span><span class="o">.</span><span class="n">colorScheme</span><span class="p">,</span> <span class="o">.</span><span class="n">dark</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









            <div class="ce-blog-thanks">
              Tack för att du läser Callistas blogg. <br>
              Hjälp oss att nå ut med information genom att dela nyheter och artiklar i ditt nätverk.<br>
            </div>

            


    
<div class="ce-blog-share">
    <a class="ce-blog-share-element social-twitter" href="https://twitter.com/intent/tweet?text=Swiftui Lists&url=https://callistaenterprise.se/blogg/teknik/2020/04/20/swiftui-lists/&via=callistaent&hashtags=" target="_blank" title="Share this post on Twitter"></a>
    <a class="ce-blog-share-element social-facebook" href="https://www.facebook.com/sharer/sharer.php?t=Swiftui Lists&u=https://callistaenterprise.se/blogg/teknik/2020/04/20/swiftui-lists/" target="_blank" title="Share this post on Facebook"></a>
    <a class="ce-blog-share-element social-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Swiftui Lists&url=https://callistaenterprise.se/blogg/teknik/2020/04/20/swiftui-lists/&source=http%3a%2f%2fzhangwenli.com" target="_blank" title="Share this post on LinkedIn"></a>
</div>
    
        </article>
    </div>
</section>


<section class="ce-section">
    <heading>
        <h1>Kommentarer</h1>
    </heading>
    <div class="ce-content">
        <div id="disqus_thread"></div>
        <script src="../../../../../../js/disqus.js"></script>
    </div>
</section>


    </div>

    <footer class="ce-footer">
    <div class="ce-wrapper">
        <nav class="ce-menu-footer-primary">
            <h2><a href="../../../../../../index.html">Callista</a></h2>
            <ul>
                
                <li><a href="../../../../../../om/index.html">Om oss</a></li>
                
                <li><a href="../../../../../../erbjudanden.html">Erbjudanden</a></li>
                
                <li><a href="../../../../../../event.html">Event</a></li>
                
                <li><a href="../../../../../../blogg.html">Blogg</a></li>
                
                <li><a href="../../../../../../om/jobb/index.html">Jobba hos oss</a></li>
                

                
                    
                        <li><a href="../../../../../../english/index.html">English</a></li>
                    
                
            </ul>
        </nav>
        <div class="ce-addresses">
            <div class="ce-address">
                <h2>Stockholm</h2>
                <address>
                    Drottninggatan 55<br>
                    111 21 Stockholm<br>
                    Tel:
                    <a href="tel:+468212142">
                        +46 8 21 21 42
                    </a>
                </address>
            </div>
            <div class="ce-address">
                <h2>Göteborg</h2>
                <address>
                    Fabriksgatan 13<br>
                    412 50 Göteborg<br>
                    Tel:
                    <a href="tel:+4631201918">
                        +46 31 20 19 18
                    </a>
                </address>
            </div>
        </div>
        <div class="ce-social">
            <h2>Följ oss</h2>
            <ul>
                <li>
                    <a href="http://twitter.com/callistaent">
                        <img alt="Twitters logotype" src="../../../../../../images/icons/twitter.png">
                        <span>@callistaent</span>
                    </a>
                </li>
            </ul>
        </div>
        <small>&copy; 2021 Callista Enterprise AB</small>
        <hr style="margin: 1em 0 2em 0">
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-raddabarnen" href="http://www.raddabarnen.se/foretag">
                <img alt="Callista är Rädda Barnens företagsvän 2021" src="../../../../../../images/logotype/rb_vanforetag_2021_large-sv.png">
            </a>
          </div>
        </div>
        <br>
        <div class="ce-footer-images">
          <div class="ce-footer-image">
            <a class="ce-di-gasell" href="http://www.di.se/gasell/">
              <img alt="Callista utsett till DI Gasell tre år i rad" src="../../../../../../images/logotype/di_gasell_180x194.png">
            </a>
          </div>
        </div>
    </div>
</footer>


    <script src="../../../../../../js/lib/jquery.min.js"></script>
    <script src="../../../../../../js/lib/owl.carousel.min.js"></script>
    <script src="../../../../../../js/lib/prismjs.min.js"></script>
    <script src="../../../../../../js/app.js"></script>
    <script src="../../../../../../js/analytics.js"></script>
    <script src="../../../../../../js/jobinterestsubmit.js"></script>

</body>
</html>
